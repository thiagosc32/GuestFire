<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        
        .admin-layout {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100vh;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            z-index: 1000;
            transition: left 0.3s ease;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar.active {
            left: 0;
        }
        
        .hamburger-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex; /* Vis√≠vel em todas as resolu√ß√µes */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .hamburger-btn.active {
            top: 14px;
            left: 246px;
        }

        .hamburger-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .hamburger-btn span {
            width: 25px;
            height: 3px;
            background: white;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .hamburger-btn.active span:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
        }

        .hamburger-btn.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger-btn.active span:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -6px);
        }
        
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header h3 {
            color: white;
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .sidebar-nav {
            padding: 20px 0;
        }

        .sidebar-nav a {
            display: block;
            padding: 15px 20px;
            color: white;
            text-decoration: none;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .sidebar-nav a:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: white;
            padding-left: 25px;
        }

        .sidebar-nav a.active {
            background: rgba(255, 255, 255, 0.2);
            border-left-color: white;
        }
        
        .main-content {
            margin-left: 0;
            transition: margin-left 0.3s ease;
            flex: 1;
            padding: 0;
        }
        
        .admin-container {
            width: 100%;
            margin: 0;
            padding: 0;
        }
        
        .admin-header {
            background: white;
            color: #333;
            padding: 20px;
            border-radius: 0;
            margin-bottom: 0;
            box-shadow: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-header h1 {
            margin: 0;
            color: #667eea;
        }
        
        .content-section {
            display: none;
            padding: 20px;
        }
        
        .content-section.active {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 0;
        }
        
        .chart-container {
            background: white;
            padding: 20px 20px 35px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            position: relative;
            height: 350px;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }
        
        /* Media queries para gr√°ficos responsivos */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .chart-container {
                height: 300px;
                padding: 15px;
            }
            
            .hamburger-btn.active {
                left: 246px !important;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .chart-container {
                height: 250px;
                padding: 10px;
            }
            
            .chart-title {
                font-size: 1em;
                margin-bottom: 10px;
            }
            
            .hamburger-btn.active {
                 left: 246px !important;
             }
        }
        
        /* Estilos para cart√µes de estat√≠sticas de pedidos de ora√ß√£o */
        .prayer-stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin: 24px 0;
            padding: 0 4px;
        }
        
        .stat-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 20px;
            padding: 32px 24px;
            text-align: center;
            box-shadow: 
                0 4px 6px -1px rgba(0, 0, 0, 0.1),
                0 2px 4px -1px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.5), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 
                0 20px 25px -5px rgba(0, 0, 0, 0.1),
                0 10px 10px -5px rgba(0, 0, 0, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .stat-card:hover::before {
            opacity: 1;
        }
        
        .stat-card.active {
            background: linear-gradient(145deg, #f0f4ff 0%, #e0e7ff 100%);
            border-color: rgba(99, 102, 241, 0.3);
        }
        
        .stat-card.active::before {
            background: linear-gradient(90deg, transparent, #6366f1, transparent);
        }
        
        .stat-card.praying {
            background: linear-gradient(145deg, #faf5ff 0%, #f3e8ff 100%);
            border-color: rgba(147, 51, 234, 0.3);
        }
        
        .stat-card.praying::before {
            background: linear-gradient(90deg, transparent, #9333ea, transparent);
        }
        
        .stat-card.answered {
            background: linear-gradient(145deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: rgba(34, 197, 94, 0.3);
        }
        
        .stat-card.answered::before {
            background: linear-gradient(90deg, transparent, #22c55e, transparent);
        }
        
        .stat-card.cancelled {
            background: linear-gradient(145deg, #fef2f2 0%, #fee2e2 100%);
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .stat-card.cancelled::before {
            background: linear-gradient(90deg, transparent, #ef4444, transparent);
        }
        
        .stat-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            display: block;
            opacity: 0.9;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover .stat-icon {
            transform: scale(1.1);
            opacity: 1;
        }
        
        .stat-number {
            font-size: 3.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #1e293b, #475569);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            line-height: 1;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover .stat-number {
            transform: scale(1.05);
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .prayer-stats-cards {
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
                gap: 20px;
                margin: 20px 0;
            }
            
            .stat-card {
                padding: 28px 20px;
                border-radius: 18px;
            }
            
            .stat-icon {
                font-size: 2.5rem;
                margin-bottom: 14px;
            }
            
            .stat-number {
                font-size: 2.8rem;
            }
            
            .stat-label {
                font-size: 0.8rem;
                letter-spacing: 0.8px;
            }
        }
        
        @media (max-width: 480px) {
            .prayer-stats-cards {
                grid-template-columns: 1fr 1fr;
                gap: 16px;
                margin: 16px 0;
                padding: 0 2px;
            }
            
            .stat-card {
                padding: 24px 16px;
                border-radius: 16px;
            }
            
            .stat-card:hover {
                transform: translateY(-4px) scale(1.01);
            }
            
            .stat-icon {
                font-size: 2.2rem;
                margin-bottom: 12px;
            }
            
            .stat-number {
                font-size: 2.4rem;
            }
            
            .stat-label {
                font-size: 0.75rem;
                letter-spacing: 0.6px;
            }
        }
        
        /* Estilos removidos - substitu√≠dos por gr√°ficos */
        
        .users-section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .section-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .search-box {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 300px;
        }
        
        .users-table {
            width: 100%;
            border-collapse: collapse;
            display: table;
        }
        
        .users-cards {
            display: none;
        }
        
        .users-table th,
        .users-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        .users-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        
        .users-table td:first-child {
            width: auto;
        }
        
        .users-table td:nth-child(2),
        .users-table td:nth-child(3) {
            width: auto;
        }
        
        .users-table td:nth-child(4) {
            width: auto;
        }
        
        .users-table td:last-child {
            width: auto;
        }
        
        /* Dropdown Actions - Melhorado */
        .dropdown-actions {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-toggle {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 500;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,123,255,0.2);
        }
        
        .dropdown-toggle:hover {
            background: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,123,255,0.3);
        }
        
        .dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 180px;
            margin-top: 4px;
            overflow: hidden;
        }
        
        .dropdown-menu.show {
            display: block;
            animation: dropdownFadeIn 0.2s ease;
        }
        
        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 12px 16px;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            font-size: 0.95em;
            color: #495057;
            transition: all 0.15s ease;
            border-bottom: 1px solid #f8f9fa;
            font-weight: 500;
        }
        
        .dropdown-item:last-child {
            border-bottom: none;
        }
        
        .dropdown-item:hover {
            background: #f8f9fa;
            color: #212529;
            padding-left: 20px;
        }
        
        .dropdown-item.view-action {
            color: #17a2b8;
        }
        
        .dropdown-item.view-action:hover {
            background: #e6f7ff;
            color: #0c7489;
        }
        
        .dropdown-item.toggle-action {
            color: #28a745;
        }
        
        .dropdown-item.toggle-action:hover {
            background: #e8f5e8;
            color: #1e7e34;
        }
        
        .dropdown-item.toggle-action.deactivate {
            color: #ffc107;
        }
        
        .dropdown-item.toggle-action.deactivate:hover {
            background: #fff8e1;
            color: #e0a800;
        }
        
        .dropdown-item.admin-action {
            color: #6f42c1;
        }
        
        .dropdown-item.admin-action:hover {
            background: #f3e8ff;
            color: #59359a;
        }
        
        .dropdown-item.btn-danger {
            color: #dc3545;
        }
        
        .dropdown-item.btn-danger:hover {
            background: #ffeaea;
            color: #bd2130;
        }
        
        .dropdown-item.disabled {
            color: #6c757d;
            cursor: not-allowed;
            background: #f8f9fa;
            font-style: italic;
        }
        
        .dropdown-item.disabled:hover {
            background: #f8f9fa;
            padding-left: 16px;
        }
        
        .dropdown-item-icon {
            margin-right: 8px;
            font-size: 1.1em;
            width: 20px;
            text-align: center;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .status-active {
            background: #d4edda;
            color: #155724;
        }
        
        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }
        

        
        /* Media Queries para Responsividade */
        @media (max-width: 768px) {
            .hamburger-btn {
                display: flex;
            }
            
            .hamburger-btn.active {
                top: 20px;
                left: 20px; /* Manter posi√ß√£o fixa no mobile */
            }
            
            .sidebar {
                left: -300px;
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .sidebar-overlay.show {
                opacity: 1;
                visibility: visible;
            }
            
            .main-content {
                margin-left: 0;
                padding: 80px 15px 20px 15px;
            }
            
            .admin-header {
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .admin-header h1 {
                font-size: 1.5em;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }
            
            .welcome-section {
                padding: 20px !important;
            }
            
            .welcome-section h1 {
                font-size: 1.8em !important;
            }
            
            .welcome-section > div {
                flex-direction: column !important;
                text-align: center !important;
            }
            
            .welcome-section > div > div:last-child {
                text-align: center !important;
                margin-top: 20px;
            }
            
            .stat-card {
                padding: 20px 15px !important;
            }
            
            .stat-card .stat-number {
                font-size: 2em !important;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-number {
                font-size: 1.5em;
            }
            
            .search-box {
                width: 100%;
                max-width: 300px;
            }
            
            /* Layout Card Responsivo para Tabela de Usu√°rios */
            .users-table-container {
                overflow-x: visible;
            }
            
            .users-table {
                display: none !important;
            }
            
            .users-cards {
                display: block !important;
                gap: 15px;
            }
            
            .user-card {
                background: white;
                border: 1px solid #dee2e6;
                border-radius: 8px;
                padding: 15px;
                margin-bottom: 15px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            .user-card-header {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                margin-bottom: 12px;
                border-bottom: 1px solid #eee;
                padding-bottom: 10px;
            }
            
            .user-card-info {
                flex: 1;
            }
            
            .user-card-name {
                font-weight: 600;
                font-size: 1.1em;
                color: #333;
                margin-bottom: 4px;
            }
            
            .user-card-email {
                font-size: 0.9em;
                color: #666;
            }
            
            .user-card-actions {
                margin-left: 10px;
            }
            
            .user-card-details {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                margin-bottom: 12px;
            }
            
            .user-card-field {
                display: flex;
                flex-direction: column;
            }
            
            .user-card-label {
                font-size: 0.8em;
                color: #666;
                font-weight: 500;
                margin-bottom: 2px;
            }
            
            .user-card-value {
                font-size: 0.9em;
                color: #333;
            }
        }
        
        @media (max-width: 480px) {
            .hamburger-btn {
                top: 15px;
                left: 15px;
                padding: 10px;
                font-size: 16px;
            }
            
            .main-content {
                padding: 70px 10px 15px 10px;
            }
            
            .admin-header {
                padding: 10px;
            }
            
            .admin-header h1 {
                font-size: 1.3em;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .stat-card {
                padding: 12px;
            }
            
            /* Layout Card Responsivo Otimizado para Mobile */
            .user-card {
                padding: 12px;
                margin-bottom: 12px;
            }
            
            .user-card-header {
                margin-bottom: 10px;
                padding-bottom: 8px;
            }
            
            .user-card-name {
                font-size: 1em;
            }
            
            .user-card-email {
                font-size: 0.85em;
            }
            
            .user-card-details {
                grid-template-columns: 1fr;
                gap: 8px;
                margin-bottom: 10px;
            }
            
            .dropdown-toggle {
                padding: 6px 10px;
                font-size: 14px;
            }
        }
        
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            margin: 0 2px;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            margin: 0 2px;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .admin-level-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .admin-level-0 {
            background: #e9ecef;
            color: #495057;
        }
        
        .admin-level-1 {
            background: #fff3cd;
            color: #856404;
        }
        
        .admin-level-2 {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .btn {
            margin: 0 2px;
            font-size: 0.8em;
        }
        
        td .btn {
            min-width: 60px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            gap: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 20px;
        }
        
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>
    <!-- Bot√£o Hamb√∫rguer -->
    <button class="hamburger-btn" id="hamburger-btn" onclick="toggleSidebar()">
        <span></span>
        <span></span>
        <span></span>
    </button>
    
    <!-- Overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>
    
    <div class="admin-layout">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>üõ°Ô∏è Admin Panel</h3>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" style="background: rgba(255, 255, 255, 0.1); border-left: 4px solid #4CAF50; margin-bottom: 10px;">
                    ‚Üê Tela Inicial App
                </a>
                <a href="#" class="active" onclick="showSection('dashboard')">
                    üìä Dashboard Admin
                </a>
                <a href="admin-users.html">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> Usu√°rios
                </a>
                <a href="admin-pedidos.html">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M12 2v20M6 8h12"/></svg> Pedidos de Ora√ß√£o
                </a>
                <a href="admin-devotionals.html">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg> Devocionais
                </a>

                <a href="admin-testimonies.html">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg> Testemunhos
                </a>
                <a href="admin-announcements.html">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 11l18-5v12L3 14v-3z"/><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"/></svg> An√∫ncios / Mensagens
                </a>
                <a href="admin-settings.html">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg> Configura√ß√µes
                </a>
                <a href="#" onclick="sidebarLogout()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg> Sair
                </a>
            </nav>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="admin-container">
                <!-- Dashboard Section -->
                <div id="dashboard" class="content-section active">
                    <!-- Welcome Section -->
                    <div class="welcome-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                            <div>
                                <h1 style="margin: 0 0 10px 0; font-size: 2.2em; font-weight: 700;"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 10px; vertical-align: middle;"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>Painel Administrativo</h1>
                                <p id="welcomeMessage" style="margin: 0 0 15px 0; font-size: 1.1em; opacity: 0.9;">Carregando...</p>
                                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 15px;">
                                    <div style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; font-size: 0.9em;">
                                        üìÖ <span id="currentDate"></span>
                                    </div>
                                    <div style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; font-size: 0.9em;">
                                        üïí <span id="currentTime"></span>
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: center; margin-top: 15px;">
                                <div style="font-size: 0.9em; opacity: 0.8;">√öltima atualiza√ß√£o: <span id="lastUpdate"></span></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <h3 style="margin: 0 0 20px 0; color: #333; font-size: 1.3em;"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px; vertical-align: middle;"><polygon points="13,2 3,14 12,14 11,22 21,10 12,10 13,2"/></svg>A√ß√µes R√°pidas</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <button onclick="window.location.href='admin-users.html'" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: transform 0.2s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px; vertical-align: middle;"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>Gerenciar Usu√°rios
                            </button>
                            <button onclick="window.location.href='admin-pedidos.html'" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: transform 0.2s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M12 2v20M6 8h12"/></svg> Pedidos de Ora√ß√£o
                            </button>
                            <button onclick="window.location.href='admin-announcements.html'" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: transform 0.2s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px; vertical-align: middle;"><path d="M3 11l18-5v12L3 14v-3z"/><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"/></svg>An√∫ncios
                            </button>
                            <button onclick="window.location.href='admin-devotionals.html'" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; border: none; padding: 15px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: transform 0.2s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px; vertical-align: middle;"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>Devocionais
                            </button>
                            <button onclick="window.location.href='admin-settings.html'" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #333; border: none; padding: 15px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: transform 0.2s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px; vertical-align: middle;"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>Configura√ß√µes
                            </button>
                        </div>
                    </div>
                    
                    <!-- Statistics Section -->
                    <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <h3 style="margin: 0 0 20px 0; color: #333; font-size: 1.3em;">üìä Estat√≠sticas do Sistema</h3>
                        <div class="stats-grid" id="statsGrid">
                            <!-- Estat√≠sticas ser√£o carregadas aqui -->
                        </div>
                    </div>
                    

                </div>
                
                <!-- Users Section -->
                <div id="users" class="content-section">
                    <div class="admin-header">
                        <div>
                            <h1><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px; vertical-align: middle;"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>Usu√°rios do Sistema</h1>
                            <p>Gerencie usu√°rios e permiss√µes</p>
                        </div>
                    </div>
                    
                    <!-- Estat√≠sticas de Usu√°rios -->
                    <div class="stats-grid" id="userStatsGrid" style="margin-bottom: 30px;">
                        <!-- Estat√≠sticas de usu√°rios ser√£o carregadas aqui -->
                    </div>
                    
                    <div class="users-section">
                        <div id="showUsersButton" style="text-align: center; padding: 40px;">
                            <button class="btn btn-primary" onclick="showAllUsers()" style="font-size: 16px; padding: 15px 30px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px; vertical-align: middle;"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>Mostrar Todos os Usu√°rios
                            </button>
                        </div>
                        <div style="text-align: center; padding: 0 40px 20px 40px;">
                            <input type="text" class="search-box" id="searchBox" placeholder="Buscar por nome ou email..." style="width: 100%; max-width: 400px;">
                        </div>
                        <div id="usersContent" style="display: none;">
                            <div class="loading">Carregando usu√°rios...</div>
                        </div>
                    </div>
                </div>
                
                <!-- Prayer Requests Section -->
                <div id="prayer-requests" class="content-section">
                    <div class="admin-header">
                        <div>
                            <h1><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="margin-right: 8px;"><path d="M12 2v20M6 8h12"/></svg>Pedidos de Ora√ß√£o</h1>
                            <p>Gerencie pedidos de ora√ß√£o dos usu√°rios</p>
                        </div>
                        <button class="btn btn-primary" onclick="showPrayerRequests()">Atualizar Lista</button>
                    </div>
                    
                    <!-- Estat√≠sticas de Pedidos de Ora√ß√£o -->
                    <div class="stats-grid" id="prayerStatsGrid" style="margin-bottom: 30px;">
                        <!-- Estat√≠sticas de pedidos de ora√ß√£o ser√£o carregadas aqui -->
                    </div>
                    
                    <div class="users-section">
                        <div id="prayerRequestsContent">
                            <p style="color: #666; text-align: center; padding: 20px;">Clique em "Atualizar Lista" para carregar os pedidos</p>
                        </div>
                    </div>
                </div>
                


                <!-- Announcements Section -->
                <div id="announcements" class="content-section">
                    <div class="admin-header">
                        <div>
                            <h1>üì¢ An√∫ncios / Mensagens</h1>
                            <p>Envie mensagens para os usu√°rios</p>
                        </div>
                        <button class="btn btn-primary">Nova Mensagem</button>
                    </div>
                    
                    <div class="users-section">
                        <button class="btn btn-secondary" onclick="showDashboard()" style="margin-bottom: 20px;">‚Üê Voltar</button>
                        <div style="padding: 40px; text-align: center; color: #666;">
                            <h3>üöß Em Desenvolvimento</h3>
                            <p>Esta se√ß√£o ser√° implementada em breve.</p>
                        </div>
                    </div>
                </div>
                

            </div>
        </div>
    </div>
    
    <script>
        // Detecta automaticamente a URL base para funcionar tanto no localhost quanto na rede
        // Detecta se estamos usando localtunnel ou localhost
        const isLocaltunnel = window.location.hostname.includes('.loca.lt');
        const API_BASE_URL = isLocaltunnel 
            ? `${window.location.protocol}//${window.location.hostname}/api`
            : `${window.location.protocol}//${window.location.hostname}:${window.location.port || '3000'}/api`;
        
        let currentPage = 1;
        let currentSearch = '';
        
        // Fun√ß√£o para obter token da sess√£o
        function getAuthToken() {
            const sessionData = localStorage.getItem('userSession') || sessionStorage.getItem('userSession');
            if (sessionData) {
                try {
                    const session = JSON.parse(sessionData);
                    return session.token;
                } catch (error) {
                    return null;
                }
            }
            return null;
        }

        // Verifica se est√° logado como admin
        async function checkAdminAccess() {
            const token = getAuthToken();
            if (!token) {
                window.location.href = '/login.html';
                return false;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/users/profile`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Token inv√°lido');
                }
                
                const data = await response.json();
                const adminEmails = ['thiagosc31@hotmail.com'];
                if (!adminEmails.includes(data.data.user.email)) {
                    alert('Acesso negado. Apenas administradores podem acessar esta p√°gina.');
                    window.location.href = '/dashboard.html';
                    return false;
                }
                
                return true;
            } catch (error) {
                console.error('Erro ao verificar acesso:', error);
                window.location.href = '/login.html';
                return false;
            }
        }
        
        // Carrega estat√≠sticas da tela inicial
        async function loadStats() {
            try {
                const token = getAuthToken();
                const response = await fetch('/api/users/admin/stats', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao carregar estat√≠sticas');
                }
                
                const data = await response.json();
                const stats = data.data;
                
                document.getElementById('statsGrid').innerHTML = `
                    <div class="chart-container">
                        <div class="chart-title">üìä Vis√£o Geral do Sistema</div>
                        <canvas id="overviewChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">üìà Atividade Di√°ria</div>
                        <canvas id="activityChart"></canvas>
                    </div>
                `;
                
                // Criar gr√°fico de vis√£o geral
                const overviewCtx = document.getElementById('overviewChart').getContext('2d');
                new Chart(overviewCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['üë• Usu√°rios', '‚úùÔ∏è Pedidos de Ora√ß√£o'],
                        datasets: [{
                            data: [stats.totalUsers, stats.totalPrayerRequests],
                            backgroundColor: [
                                '#667eea',
                                '#764ba2'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 25,
                                    usePointStyle: true,
                                    boxWidth: 12,
                                    font: {
                                        size: 12
                                    }
                                },
                                align: 'center'
                            }
                        },
                        layout: {
                            padding: {
                                bottom: 20
                            }
                        }
                    }
                });
                
                // Criar gr√°fico de atividade
                const activityCtx = document.getElementById('activityChart').getContext('2d');
                new Chart(activityCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Logins Hoje', 'Novos Usu√°rios', 'Pedidos Hoje'],
                        datasets: [{
                            label: 'Atividade',
                            data: [stats.todayLogins, stats.todayUsers || 5, stats.todayPrayerRequests || 8],
                            backgroundColor: [
                                '#667eea',
                                '#764ba2'
                            ],
                            borderRadius: 8,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: '#f0f0f0'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas:', error);
                document.getElementById('statsGrid').innerHTML = `
                    <div class="chart-container">
                        <div class="chart-title">üìä Vis√£o Geral do Sistema</div>
                        <canvas id="overviewChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">üìà Atividade Di√°ria</div>
                        <canvas id="activityChart"></canvas>
                    </div>
                `;
                
                // Criar gr√°fico de vis√£o geral com dados de exemplo
                const overviewCtx = document.getElementById('overviewChart').getContext('2d');
                new Chart(overviewCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['üë• Usu√°rios', '‚úùÔ∏è Pedidos de Ora√ß√£o'],
                        datasets: [{
                            data: [1237, 456],
                            backgroundColor: [
                                '#667eea',
                                '#764ba2'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 25,
                                    usePointStyle: true,
                                    boxWidth: 12,
                                    font: {
                                        size: 12
                                    }
                                },
                                align: 'center'
                            }
                        },
                        layout: {
                            padding: {
                                bottom: 20
                            }
                        }
                    }
                });
                
                // Criar gr√°fico de atividade com dados de exemplo
                const activityCtx = document.getElementById('activityChart').getContext('2d');
                new Chart(activityCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Logins Hoje', 'Novos Usu√°rios', 'Pedidos Hoje'],
                        datasets: [{
                            label: 'Atividade',
                            data: [89, 12, 23],
                            backgroundColor: [
                                '#667eea',
                                '#764ba2',
                                '#f093fb'
                            ],
                            borderRadius: 8,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: '#f0f0f0'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Carrega estat√≠sticas de usu√°rios para a se√ß√£o de usu√°rios
        async function loadUserStats() {
            try {
                const token = getAuthToken();
                const response = await fetch(`${API_BASE_URL}/users/admin/stats`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao carregar estat√≠sticas de usu√°rios');
                }
                
                const data = await response.json();
                const stats = data.data;
                
                document.getElementById('userStatsGrid').innerHTML = `
                    <div class="chart-container">
                        <div class="chart-title">üë• Status dos Usu√°rios</div>
                        <canvas id="userStatusChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">üìä Crescimento de Usu√°rios</div>
                        <canvas id="userGrowthChart"></canvas>
                    </div>
                `;
                
                // Gr√°fico de status dos usu√°rios
                const userStatusCtx = document.getElementById('userStatusChart').getContext('2d');
                new Chart(userStatusCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Usu√°rios Ativos', 'Usu√°rios Inativos'],
                        datasets: [{
                            data: [stats.activeUsers, stats.inactiveUsers],
                            backgroundColor: [
                                '#667eea',
                                '#e0e0e0'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 15,
                                    usePointStyle: true
                                }
                            }
                        }
                    }
                });
                
                // Gr√°fico de crescimento
                const userGrowthCtx = document.getElementById('userGrowthChart').getContext('2d');
                new Chart(userGrowthCtx, {
                    type: 'line',
                    data: {
                        labels: ['Total', 'Novos Hoje', 'Novos Semana', 'Logins Hoje'],
                        datasets: [{
                            label: 'Usu√°rios',
                            data: [stats.totalUsers, stats.todayUsers, stats.weekUsers, stats.todayLogins],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#667eea',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: '#f0f0f0'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas de usu√°rios:', error);
                document.getElementById('userStatsGrid').innerHTML = '<div class="error">Erro ao carregar estat√≠sticas de usu√°rios</div>';
            }
        }
        
        // Carrega estat√≠sticas de pedidos de ora√ß√£o para a se√ß√£o de pedidos
        async function loadPrayerStats() {
            const prayerStatsElement = document.getElementById('prayerStatsGrid');
            
            // Verificar se o elemento existe
            if (!prayerStatsElement) {
                console.error('Elemento prayerStatsGrid n√£o encontrado!');
                return;
            }
            
            // Mostrar loading
            prayerStatsElement.innerHTML = '<div class="loading">Carregando estat√≠sticas...</div>';
            
            try {
                const token = getAuthToken();
                console.log('=== DEBUG PRAYER STATS ===');
                console.log('Token:', token ? `Presente (${token.substring(0, 20)}...)` : 'Ausente');
                console.log('API_BASE_URL:', API_BASE_URL);
                console.log('URL completa:', `${API_BASE_URL}/users/admin/stats`);
                
                if (!token) {
                    throw new Error('Token de autentica√ß√£o n√£o encontrado');
                }
                
                const response = await fetch(`${API_BASE_URL}/users/admin/stats`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', Object.fromEntries(response.headers.entries()));
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Erro na resposta:', errorText);
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const data = await response.json();
                console.log('Dados completos recebidos:', JSON.stringify(data, null, 2));
                
                if (!data.success) {
                    throw new Error(data.message || 'API retornou success: false');
                }
                
                const stats = data.data;
                console.log('Stats extra√≠das:', JSON.stringify(stats, null, 2));
                
                if (!stats) {
                    throw new Error('Propriedade data n√£o encontrada na resposta');
                }
                
                // Verificar se as propriedades existem
                console.log('Verificando propriedades:');
                console.log('- activePrayerRequests:', stats.activePrayerRequests);
                console.log('- prayingRequests:', stats.prayingRequests);
                console.log('- answeredRequests:', stats.answeredRequests);
                console.log('- cancelledRequests:', stats.cancelledRequests);
                
                prayerStatsElement.innerHTML = `
                    <div class="prayer-stats-cards">
                        <div class="stat-card active" onclick="redirectToPrayerDetails('ativo')" style="cursor: pointer;">
                            <div class="stat-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></div>
                            <div class="stat-number">${stats.activePrayerRequests || 0}</div>
                            <div class="stat-label">Pedidos Aguardando Ora√ß√£o</div>
                        </div>
                        <div class="stat-card praying" onclick="redirectToPrayerDetails('em_oracao')" style="cursor: pointer;">
                            <div class="stat-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M12 2v20M6 8h12"/></svg></div>
                            <div class="stat-number">${stats.prayingRequests || 0}</div>
                            <div class="stat-label">Em Ora√ß√£o</div>
                        </div>
                        <div class="stat-card answered" onclick="redirectToPrayerDetails('respondido')" style="cursor: pointer;">
                            <div class="stat-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 12l2 2 4-4"/><circle cx="12" cy="12" r="10"/></svg></div>
                            <div class="stat-number">${stats.answeredRequests || 0}</div>
                            <div class="stat-label">Respondidos</div>
                        </div>
                        <div class="stat-card cancelled" onclick="redirectToPrayerDetails('cancelado')" style="cursor: pointer;">
                            <div class="stat-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M15 9l-6 6"/><path d="M9 9l6 6"/></svg></div>
                            <div class="stat-number">${stats.cancelledRequests || 0}</div>
                            <div class="stat-label">Cancelados</div>
                        </div>
                    </div>
                `;
                
                console.log('‚úÖ Estat√≠sticas carregadas com sucesso!');
                console.log('=== FIM DEBUG ===');

            } catch (error) {
                console.error('‚ùå Erro ao carregar estat√≠sticas de pedidos:', error);
                prayerStatsElement.innerHTML = `
                    <div class="error" style="padding: 20px; background: #f8d7da; color: #721c24; border-radius: 8px; margin: 10px 0;">
                        <strong>Erro ao carregar estat√≠sticas:</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }
        
        // Carrega usu√°rios
        async function loadUsers(page = 1, search = '') {
            try {
                const token = getAuthToken();
                const url = new URL(`${API_BASE_URL}/users/admin/users`);
                url.searchParams.append('page', page);
                url.searchParams.append('limit', '10');
                if (search) {
                    url.searchParams.append('search', search);
                }
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao carregar usu√°rios');
                }
                
                const data = await response.json();
                const users = data.data.users;
                const pagination = data.data.pagination;
                
                let tableHTML = `
                    <div class="users-table-container" style="overflow-x: auto; width: 100%; max-width: 100%;">
                        <table class="users-table">
                            <thead>
                                <tr>
                                    <th>Usu√°rio</th>
                        <th>Status</th>
                        <th>Admin</th>
                        <th>Data</th>
                        <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                let cardsHTML = '<div class="users-cards">';
                
                users.forEach(user => {
                    const createdAt = new Date(user.createdAt).toLocaleDateString('pt-BR');
                    const statusClass = user.isActive ? 'status-active' : 'status-inactive';
                    const statusText = user.isActive ? 'Ativo' : 'Inativo';
                    const toggleText = user.isActive ? 'Desativar' : 'Ativar';
                    const toggleClass = user.isActive ? 'btn-danger' : 'btn-success';
                    
                    const adminLevelName = user.adminLevelName || getAdminLevelName(user.adminLevel);
                    
                    tableHTML += `
                        <tr>
                            <td>
                                <div style="font-weight: 600;">${user.fullName}</div>
                                <div style="font-size: 0.8em; color: #666;">${user.email}</div>
                            </td>
                            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            <td>
                                <span class="admin-level-badge admin-level-${user.adminLevel}">
                                    ${adminLevelName}
                                </span>
                            </td>
                            <td>${createdAt}</td>
                            <td>
                                <div class="dropdown-actions">
                                    <button class="btn btn-secondary dropdown-toggle" onclick="toggleDropdown(${user.id})">
                                        ‚ãÆ
                                    </button>
                                    <div class="dropdown-menu" id="dropdown-${user.id}">
                                        <button class="dropdown-item view-action" onclick="viewUser(${user.id})">
                                            <span class="dropdown-item-icon">üëÅÔ∏è</span>Visualizar Perfil
                                        </button>
                                        ${user.email !== 'thiagosc31@hotmail.com' ? 
                                            `<button class="dropdown-item toggle-action ${!user.isActive ? '' : 'deactivate'}" onclick="toggleUserStatus(${user.id}, ${!user.isActive})">
                                                <span class="dropdown-item-icon">${toggleText === 'Ativar' ? '‚úÖ' : '‚è∏Ô∏è'}</span>${toggleText === 'Ativar' ? 'Ativar Usu√°rio' : 'Desativar Usu√°rio'}
                                             </button>
                                             <button class="dropdown-item admin-action" onclick="changeAdminLevel(${user.id})">
                                                <span class="dropdown-item-icon">‚öôÔ∏è</span>Alterar N√≠vel Admin
                                             </button>
                                             <button class="dropdown-item btn-danger" onclick="deleteUser(${user.id})">
                                                <span class="dropdown-item-icon">üóëÔ∏è</span><span style="color: white; text-shadow: 1px 1px 1px black;">Excluir Usu√°rio</span>
                                             </button>` : 
                                            '<span class="dropdown-item disabled"><span class="dropdown-item-icon">üëë</span>Administrador Principal</span>'
                                        }
                                    </div>
                                </div>
                            </td>
                        </tr>
                    `;
                    
                    // Gerar card responsivo
                    cardsHTML += `
                        <div class="user-card">
                            <div class="user-card-header">
                                <div class="user-card-info">
                                    <div class="user-card-name">${user.fullName}</div>
                                    <div class="user-card-email">${user.email}</div>
                                </div>
                                <div class="user-card-actions">
                                    <div class="dropdown-actions">
                                        <button class="btn btn-secondary dropdown-toggle" onclick="toggleDropdown('card-${user.id}')">
                                            ‚ãÆ
                                        </button>
                                        <div class="dropdown-menu" id="dropdown-card-${user.id}">
                                            <button class="dropdown-item view-action" onclick="viewUser(${user.id})">
                                                <span class="dropdown-item-icon">üëÅÔ∏è</span>Visualizar Perfil
                                            </button>
                                            ${user.email !== 'thiagosc31@hotmail.com' ? 
                                                `<button class="dropdown-item toggle-action ${!user.isActive ? '' : 'deactivate'}" onclick="toggleUserStatus(${user.id}, ${!user.isActive})">
                                                    <span class="dropdown-item-icon">${toggleText === 'Ativar' ? '‚úÖ' : '‚è∏Ô∏è'}</span>${toggleText === 'Ativar' ? 'Ativar Usu√°rio' : 'Desativar Usu√°rio'}
                                                 </button>
                                                 <button class="dropdown-item admin-action" onclick="changeAdminLevel(${user.id})">
                                                    <span class="dropdown-item-icon">‚öôÔ∏è</span>Alterar N√≠vel Admin
                                                 </button>
                                                 <button class="dropdown-item btn-danger" onclick="deleteUser(${user.id})">
                                                     <span class="dropdown-item-icon">üóëÔ∏è</span><span style="color: white; text-shadow: 1px 1px 1px black;">Excluir Usu√°rio</span>
                                                  </button>` : 
                                                '<span class="dropdown-item disabled"><span class="dropdown-item-icon">üëë</span>Administrador Principal</span>'
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="user-card-details">
                                <div class="user-card-field">
                                    <div class="user-card-label">Status</div>
                                    <div class="user-card-value">
                                        <span class="status-badge ${statusClass}">${statusText}</span>
                                    </div>
                                </div>
                                <div class="user-card-field">
                                    <div class="user-card-label">N√≠vel Admin</div>
                                    <div class="user-card-value">
                                        <span class="admin-level-badge admin-level-${user.adminLevel}">
                                            ${adminLevelName}
                                        </span>
                                    </div>
                                </div>
                                <div class="user-card-field">
                                    <div class="user-card-label">Data de Cria√ß√£o</div>
                                    <div class="user-card-value">${createdAt}</div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                tableHTML += '</tbody></table></div>';
                cardsHTML += '</div>';
                
                // Adiciona pagina√ß√£o
                let paginationHTML = '<div class="pagination">';
                
                if (pagination.page > 1) {
                    paginationHTML += `<button class="btn btn-secondary" onclick="loadUsers(${pagination.page - 1}, '${search}')">Anterior</button>`;
                }
                
                paginationHTML += `<span>P√°gina ${pagination.page} de ${pagination.totalPages} (${pagination.total} usu√°rios)</span>`;
                
                if (pagination.page < pagination.totalPages) {
                    paginationHTML += `<button class="btn btn-secondary" onclick="loadUsers(${pagination.page + 1}, '${search}')">Pr√≥xima</button>`;
                }
                
                paginationHTML += '</div>';
                
                document.getElementById('usersContent').innerHTML = tableHTML + cardsHTML + paginationHTML;
                
            } catch (error) {
                console.error('Erro ao carregar usu√°rios:', error);
                document.getElementById('usersContent').innerHTML = '<div class="error">Erro ao carregar usu√°rios</div>';
            }
        }
        
        // Alterna status do usu√°rio
        async function toggleUserStatus(userId, newStatus) {
            if (!confirm(`Tem certeza que deseja ${newStatus ? 'ativar' : 'desativar'} este usu√°rio?`)) {
                return;
            }
            
            try {
                const token = getAuthToken();
                const response = await fetch(`${API_BASE_URL}/users/admin/users/${userId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ isActive: newStatus })
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao alterar status');
                }
                
                const data = await response.json();
                alert(data.message);
                loadUsers(currentPage, currentSearch);
                loadStats(); // Atualiza estat√≠sticas
                
            } catch (error) {
                console.error('Erro ao alterar status:', error);
                alert('Erro ao alterar status do usu√°rio');
            }
        }
        
        // Visualiza detalhes do usu√°rio
        async function viewUser(userId) {
            try {
                const token = getAuthToken();
                const response = await fetch(`${API_BASE_URL}/users/admin/users/${userId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao carregar usu√°rio');
                }
                
                const data = await response.json();
                const user = data.data.user;
                const loginHistory = data.data.loginHistory;
                
                let historyHTML = '';
                if (loginHistory.length > 0) {
                    historyHTML = loginHistory.map(log => {
                        const date = new Date(log.createdAt).toLocaleString('pt-BR');
                        const status = log.success ? '‚úÖ Sucesso' : '‚ùå Falha';
                        return `${date} - ${status} - IP: ${log.ipAddress || 'N/A'}`;
                    }).join('\n');
                } else {
                    historyHTML = 'Nenhum hist√≥rico de login encontrado';
                }
                
                const userInfo = `
Detalhes do Usu√°rio:

ID: ${user.id}
Nome: ${user.fullName}
Email: ${user.email}
Status: ${user.isActive ? 'Ativo' : 'Inativo'}
Criado em: ${new Date(user.createdAt).toLocaleString('pt-BR')}
√öltima atualiza√ß√£o: ${new Date(user.updatedAt).toLocaleString('pt-BR')}

√öltimos 10 logins:
${historyHTML}
                `;
                
                alert(userInfo);
                
            } catch (error) {
                console.error('Erro ao carregar usu√°rio:', error);
                alert('Erro ao carregar detalhes do usu√°rio');
            }
        }
        
        // Editar usu√°rio
        async function editUser(userId) {
            try {
                const token = getAuthToken();
                const response = await fetch(`${API_BASE_URL}/users/admin/users/${userId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao carregar usu√°rio');
                }
                
                const data = await response.json();
                const user = data.data.user;
                
                // Cria formul√°rio de edi√ß√£o
                const newName = prompt('Nome completo:', user.fullName);
                if (newName === null) return; // Cancelou
                
                const newEmail = prompt('Email:', user.email);
                if (newEmail === null) return; // Cancelou
                
                const newPassword = prompt('Nova senha (deixe em branco para manter a atual):');
                
                // Prepara dados para envio
                const updateData = {};
                if (newName.trim() && newName !== user.fullName) {
                    updateData.fullName = newName.trim();
                }
                if (newEmail.trim() && newEmail !== user.email) {
                    updateData.email = newEmail.trim();
                }
                if (newPassword && newPassword.trim()) {
                    updateData.password = newPassword;
                }
                
                if (Object.keys(updateData).length === 0) {
                    alert('Nenhuma altera√ß√£o foi feita.');
                    return;
                }
                
                // Envia atualiza√ß√£o
                const updateResponse = await fetch(`${API_BASE_URL}/users/admin/users/${userId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });
                
                const updateResult = await updateResponse.json();
                
                if (updateResponse.ok) {
                    alert(updateResult.message);
                    loadUsers(currentPage, currentSearch);
                    loadStats();
                } else {
                    alert(updateResult.message || 'Erro ao atualizar usu√°rio');
                }
                
            } catch (error) {
                console.error('Erro ao editar usu√°rio:', error);
                alert('Erro ao editar usu√°rio');
            }
        }
        
        // Fun√ß√£o auxiliar para obter nome do n√≠vel de administrador
        function getAdminLevelName(level) {
            switch (level) {
                case 0: return 'Usu√°rio';
                case 1: return 'Administrador';
                case 2: return 'Super Admin';
                default: return 'Desconhecido';
            }
        }

        // Alterar n√≠vel de administrador
        async function changeAdminLevel(userId) {
            try {
                const token = getAuthToken();
                
                // Busca dados do usu√°rio
                const response = await fetch(`${API_BASE_URL}/users/admin/users/${userId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao carregar usu√°rio');
                }
                
                const data = await response.json();
                const user = data.data.user;
                
                // Busca informa√ß√µes sobre os n√≠veis dispon√≠veis
                const levelsResponse = await fetch(`${API_BASE_URL}/users/admin/levels`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!levelsResponse.ok) {
                    throw new Error('Erro ao carregar n√≠veis');
                }
                
                const levelsData = await levelsResponse.json();
                const levels = levelsData.data.levels;
                const currentUserLevel = levelsData.data.currentUserLevel;
                
                // Verifica se o usu√°rio atual pode alterar n√≠veis (apenas super admin)
                if (currentUserLevel < 2) {
                    alert('Apenas Super Administradores podem alterar n√≠veis de acesso.');
                    return;
                }
                
                // Cria op√ß√µes para sele√ß√£o
                let options = 'Selecione o novo n√≠vel de administrador:\n\n';
                levels.forEach((level, index) => {
                    options += `${index + 1}. ${level.name} - ${level.description}\n`;
                });
                options += '\nDigite o n√∫mero da op√ß√£o desejada:';
                
                const choice = prompt(options);
                if (choice === null) return; // Cancelou
                
                const selectedIndex = parseInt(choice) - 1;
                if (selectedIndex < 0 || selectedIndex >= levels.length) {
                    alert('Op√ß√£o inv√°lida!');
                    return;
                }
                
                const newLevel = levels[selectedIndex];
                
                // Confirma√ß√£o
                if (!confirm(`Alterar n√≠vel de "${user.fullName}" para "${newLevel.name}"?\n\nUsu√°rio: ${user.email}\nN√≠vel atual: ${user.adminLevelName}\nNovo n√≠vel: ${newLevel.name}`)) {
                    return;
                }
                
                // Envia altera√ß√£o
                const updateResponse = await fetch(`${API_BASE_URL}/users/admin/users/${userId}/admin-level`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        adminLevel: newLevel.value
                    })
                });
                
                const updateResult = await updateResponse.json();
                
                if (updateResponse.ok) {
                    alert(updateResult.message);
                    loadUsers(currentPage, currentSearch);
                    loadStats();
                } else {
                    alert(updateResult.message || 'Erro ao alterar n√≠vel de administrador');
                }
                
            } catch (error) {
                console.error('Erro ao alterar n√≠vel de administrador:', error);
                alert('Erro ao alterar n√≠vel de administrador');
            }
        }

        // Deletar usu√°rio
        async function deleteUser(userId) {
            try {
                const token = getAuthToken();
                
                // Busca dados do usu√°rio para confirma√ß√£o
                const response = await fetch(`${API_BASE_URL}/users/admin/users/${userId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao carregar usu√°rio');
                }
                
                const data = await response.json();
                const user = data.data.user;
                
                if (!confirm(`Tem certeza que deseja DELETAR permanentemente o usu√°rio:\n\nNome: ${user.fullName}\nEmail: ${user.email}\n\nEsta a√ß√£o n√£o pode ser desfeita!`)) {
                    return;
                }
                
                // Confirma novamente
                if (!confirm('ATEN√á√ÉO: Esta a√ß√£o √© IRREVERS√çVEL!\n\nDigite "DELETAR" para confirmar:')) {
                    return;
                }
                
                // Deleta o usu√°rio
                const deleteResponse = await fetch(`${API_BASE_URL}/users/admin/users/${userId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const deleteResult = await deleteResponse.json();
                
                if (deleteResponse.ok) {
                    alert(deleteResult.message);
                    loadUsers(currentPage, currentSearch);
                    loadStats();
                } else {
                    alert(deleteResult.message || 'Erro ao deletar usu√°rio');
                }
                
            } catch (error) {
                console.error('Erro ao deletar usu√°rio:', error);
                alert('Erro ao deletar usu√°rio');
            }
        }

        // Logout
        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                localStorage.removeItem('userSession');
                sessionStorage.removeItem('userSession');
                window.location.href = '/login.html';
            }
        }
        
        // Fun√ß√£o para retornar ao dashboard
        function goToDashboard() {
            window.location.href = '/dashboard.html';
        }
        


        
        async function showPrayerRequests() {
            try {
                const token = getAuthToken();
                const response = await fetch(`${API_BASE_URL}/pedidos/admin`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao carregar pedidos de ora√ß√£o');
                }
                
                const data = await response.json();
                
                // Verificar se estamos na se√ß√£o de pedidos de ora√ß√£o ou no dashboard
                const prayerSection = document.getElementById('prayer-requests');
                const isPrayerSectionActive = prayerSection && prayerSection.style.display !== 'none';
                
                if (isPrayerSectionActive) {
                    // Se estamos na se√ß√£o de pedidos, mostrar no prayerRequestsContent
                    displayPrayerRequestsInSection(data.data || []);
                } else {
                    // Se estamos no dashboard, mostrar na tableContent
                    displayPrayerRequests(data.data || []);
                }
                
            } catch (error) {
                console.error('Erro ao carregar pedidos:', error);
                const prayerSection = document.getElementById('prayer-requests');
                const isPrayerSectionActive = prayerSection && prayerSection.style.display !== 'none';
                
                const targetElement = isPrayerSectionActive 
                    ? document.getElementById('prayerRequestsContent')
                    : document.getElementById('tableContent');
                    
                if (targetElement) {
                    targetElement.innerHTML = `
                        <div class="error">Erro ao carregar pedidos de ora√ß√£o: ${error.message}</div>
                    `;
                }
            }
        }
        
        function displayPrayerRequests(requests) {
            const tableContent = document.getElementById('tableContent');
            
            if (!requests || requests.length === 0) {
                tableContent.innerHTML = `
                    <p style="color: #666; text-align: center; padding: 20px;">Nenhum pedido de ora√ß√£o encontrado</p>
                `;
                return;
            }
            
            let tableHTML = `
                <h3><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="margin-right: 8px;"><path d="M12 2v20M6 8h12"/></svg>Pedidos de Ora√ß√£o</h3>
                <div style="overflow-x: auto;">
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Usu√°rio</th>
                                <th>Categoria</th>
                                <th>Descri√ß√£o</th>
                                <th>Status</th>
                                <th>Data de Cria√ß√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            requests.forEach(request => {
                const createdAt = new Date(request.created_at).toLocaleString('pt-BR');
                const description = request.description.length > 100 
                    ? request.description.substring(0, 100) + '...' 
                    : request.description;
                
                const statusBadge = getStatusBadge(request.status);
                
                tableHTML += `
                    <tr>
                        <td>${request.id}</td>
                        <td>${request.user_name || 'N/A'}</td>
                        <td><span class="status-badge" style="background: #e3f2fd; color: #1565c0;">${request.category}</span></td>
                        <td title="${request.description}">${description}</td>
                        <td>${statusBadge}</td>
                        <td>${createdAt}</td>
                        <td>
                            <button class="btn btn-primary" onclick="viewFullRequest(${request.id}, '${request.description.replace(/'/g, "\\'")}')">Ver Completo</button>
                            <button class="btn btn-warning" onclick="updateRequestStatus(${request.id}, '${request.status}')">Alterar Status</button>
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += `
                        </tbody>
                    </table>
                </div>
                <p style="margin-top: 10px; color: #666; font-size: 0.9em;">Total de pedidos: ${requests.length}</p>
            `;
            
            tableContent.innerHTML = tableHTML;
        }
        
        function displayPrayerRequestsInSection(requests) {
            const content = document.getElementById('prayerRequestsContent');
            
            if (!requests || requests.length === 0) {
                content.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <h3>üìù Nenhum Pedido Encontrado</h3>
                        <p>N√£o h√° pedidos de ora√ß√£o cadastrados no momento.</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h3 style="margin: 0; color: #495057;">üìä Total de Pedidos: ${requests.length}</h3>
                </div>
                <div style="overflow-x: auto;">
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Usu√°rio</th>
                                <th>T√≠tulo</th>
                                <th>Categoria</th>
                                <th>Status</th>
                                <th>Privacidade</th>
                                <th>Data</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            requests.forEach(request => {
                const date = new Date(request.created_at).toLocaleDateString('pt-BR');
                const statusBadge = getStatusBadge(request.status);
                const privacyBadge = request.is_private ? 
                    '<span class="status-badge" style="background: #dc3545; color: white;">üîí Privado</span>' : 
                    '<span class="status-badge" style="background: #28a745; color: white;">üåç P√∫blico</span>';
                
                const title = request.title || request.description.substring(0, 50) + '...';
                
                html += `
                    <tr>
                        <td>${request.id}</td>
                        <td>${request.user_name || 'N/A'}</td>
                        <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;" title="${request.description}">${title}</td>
                        <td><span class="status-badge" style="background: #e3f2fd; color: #1565c0;">${request.category}</span></td>
                        <td>${statusBadge}</td>
                        <td>${privacyBadge}</td>
                        <td>${date}</td>
                        <td>
                            <button class="btn btn-primary" onclick="viewFullRequest(${request.id}, '${request.description.replace(/'/g, "\\'")}')">Ver</button>
                            <button class="btn btn-warning" onclick="updateRequestStatus(${request.id}, '${request.status}')">Status</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            content.innerHTML = html;
        }
        
        function getStatusBadge(status) {
            switch(status) {
                case 'pending':
                    return '<span class="status-badge" style="background: #fff3cd; color: #856404;">Aguardando Ora√ß√£o</span>';
                case 'praying':
                    return '<span class="status-badge" style="background: #d1ecf1; color: #0c5460;">Orando</span>';
                case 'answered':
                    return '<span class="status-badge" style="background: #d4edda; color: #155724;">Respondido</span>';
                case 'cancelled':
                    return '<span class="status-badge" style="background: #f8d7da; color: #721c24;">Cancelado</span>';
                default:
                    return '<span class="status-badge" style="background: #e9ecef; color: #495057;">' + status + '</span>';
            }
        }
        
        function viewFullRequest(id, description) {
            alert(`Pedido de Ora√ß√£o #${id}\n\n${description}`);
        }
        
        async function updateRequestStatus(id, currentStatus) {
            const statusOptions = {
                '1': { value: 'pending', label: 'Aguardando Ora√ß√£o' },
                '2': { value: 'praying', label: 'Orando' },
                '3': { value: 'answered', label: 'Respondido' }
            };
            
            const currentStatusLabel = {
                'pending': 'Aguardando Ora√ß√£o',
                'praying': 'Orando', 
                'answered': 'Respondido'
            }[currentStatus] || currentStatus;
            
            const choice = prompt(`Alterar status do pedido #${id}:\n\nStatus atual: ${currentStatusLabel}\n\nSelecione o novo status:\n1 - Aguardando Ora√ß√£o\n2 - Orando\n3 - Respondido\n\nDigite o n√∫mero (1, 2 ou 3):`);
            
            if (!choice || !statusOptions[choice]) {
                if (choice) {
                    alert('Op√ß√£o inv√°lida! Digite 1, 2 ou 3.');
                }
                return;
            }
            
            const newStatus = statusOptions[choice].value;
            
            if (newStatus === currentStatus) {
                return;
            }
            
            try {
                const token = getAuthToken();
                const response = await fetch(`${API_BASE_URL}/pedidos/admin/${id}/status`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: newStatus })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    alert('Status atualizado com sucesso!');
                    showPrayerRequests(); // Recarrega a lista
                } else {
                    alert('Erro ao atualizar status: ' + (result.message || 'Erro desconhecido'));
                }
                
            } catch (error) {
                console.error('Erro ao atualizar status:', error);
                alert('Erro ao atualizar status do pedido');
            }
        }


        
        // Fun√ß√£o para navegar entre se√ß√µes
        // Fun√ß√£o removida - substitu√≠da pela vers√£o com suporte mobile
        
        // Fun√ß√µes para controle do menu hamb√∫rguer
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const hamburgerBtn = document.getElementById('hamburger-btn');
            
            // Verificar se √© mobile
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('show');
            } else {
                sidebar.classList.toggle('active');
                overlay.classList.toggle('active');
            }
            hamburgerBtn.classList.toggle('active');
        }
        
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const hamburgerBtn = document.getElementById('hamburger-btn');
            
            // Remover todas as classes poss√≠veis
            sidebar.classList.remove('active', 'open');
            overlay.classList.remove('active', 'show');
            hamburgerBtn.classList.remove('active');
        }
        
        // Fechar sidebar ao clicar em um item do menu (mobile)
        function showSection(sectionId) {
            // Esconder todas as se√ß√µes
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.style.display = 'none';
            });
            
            // Mostrar a se√ß√£o selecionada
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            // Atualizar menu ativo
            const menuItems = document.querySelectorAll('.sidebar-nav a');
            menuItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Encontrar e ativar o item do menu correspondente
            const activeMenuItem = Array.from(menuItems).find(item => {
                const onclick = item.getAttribute('onclick');
                return onclick && onclick.includes(`'${sectionId}'`);
            });
            
            if (activeMenuItem) {
                activeMenuItem.classList.add('active');
            }
            
            // Carregar dados espec√≠ficos da se√ß√£o
            if (sectionId === 'users') {
                loadUserStats();
                // N√£o carregar usu√°rios automaticamente - aguardar clique no bot√£o
            } else if (sectionId === 'prayer-requests') {
                loadPrayerStats();
                // Os pedidos ser√£o carregados quando o usu√°rio clicar em "Atualizar Lista"
            }
            
            // Fechar sidebar no mobile
            closeSidebar();
        }
        
        // Fun√ß√£o para logout do sidebar
        function sidebarLogout() {
            if (confirm('Tem certeza que deseja sair?')) {
                localStorage.removeItem('userSession');
                sessionStorage.removeItem('userSession');
                window.location.href = '/login.html';
            }
        }
        
        // Fun√ß√£o para mostrar dashboard (compatibilidade)
        function showDashboard() {
            showSection('dashboard');
        }
        
        // Fun√ß√£o para logout do sidebar
        function sidebarLogout() {
            if (confirm('Tem certeza que deseja sair?')) {
                localStorage.removeItem('userSession');
                sessionStorage.removeItem('userSession');
                window.location.href = '/login.html';
            }
        }
        
        // Fun√ß√£o para alternar exibi√ß√£o dos usu√°rios
         function showAllUsers() {
             const usersContent = document.getElementById('usersContent');
             const button = document.querySelector('#showUsersButton button');
             
             if (usersContent.style.display === 'none' || usersContent.style.display === '') {
                 // Mostrar usu√°rios
                 usersContent.style.display = 'block';
                 button.innerHTML = 'üôà Esconder Usu√°rios';
                 loadUsers();
             } else {
                 // Esconder usu√°rios
                 usersContent.style.display = 'none';
                 button.innerHTML = 'üë• Mostrar Todos os Usu√°rios';
             }
         }
        
        // Busca
        document.getElementById('searchBox').addEventListener('input', function(e) {
            currentSearch = e.target.value;
            currentPage = 1;
            setTimeout(() => {
                if (currentSearch === e.target.value) {
                    // S√≥ buscar se os usu√°rios j√° est√£o sendo exibidos
                    if (document.getElementById('usersContent').style.display !== 'none') {
                        loadUsers(currentPage, currentSearch);
                    }
                }
            }, 500);
        });
        
        // Fun√ß√£o para controlar dropdown de a√ß√µes
        function toggleDropdown(userId) {
            const dropdown = document.getElementById(`dropdown-${userId}`);
            const allDropdowns = document.querySelectorAll('.dropdown-menu');
            
            // Fechar todos os outros dropdowns
            allDropdowns.forEach(menu => {
                if (menu.id !== `dropdown-${userId}`) {
                    menu.classList.remove('show');
                }
            });
            
            // Toggle do dropdown atual
            dropdown.classList.toggle('show');
        }
        
        // Fechar dropdown ao clicar fora
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.dropdown-actions')) {
                document.querySelectorAll('.dropdown-menu').forEach(menu => {
                    menu.classList.remove('show');
                });
            }
        });
        
        // Event listener para redimensionamento da janela (mobile)
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            // Se mudou para desktop, garantir que usa as classes corretas
            if (window.innerWidth > 768) {
                sidebar.classList.remove('open');
                overlay.classList.remove('show');
                // Fechar sidebar no desktop se estiver aberta
                if (sidebar.classList.contains('active')) {
                    closeSidebar();
                }
            } else {
                // Se mudou para mobile, garantir que usa as classes corretas
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            }
        });
        
        // Fun√ß√£o para carregar informa√ß√µes do usu√°rio logado
        async function loadWelcomeMessage() {
            try {
                const token = getAuthToken();
                const response = await fetch(`${API_BASE_URL}/users/profile`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const user = data.data.user;
                    const firstName = user.fullName.split(' ')[0];
                    
                    document.getElementById('welcomeMessage').innerHTML = `
                        Bem-vindo de volta, <strong>${firstName}</strong>! üëã<br>
                        <span style="font-size: 0.9em; opacity: 0.8;">Gerencie seu sistema com facilidade e efici√™ncia</span>
                    `;
                } else {
                    document.getElementById('welcomeMessage').textContent = 'Bem-vindo ao Painel Administrativo!';
                }
            } catch (error) {
                console.error('Erro ao carregar informa√ß√µes do usu√°rio:', error);
                document.getElementById('welcomeMessage').textContent = 'Bem-vindo ao Painel Administrativo!';
            }
        }
        
        // Fun√ß√£o para atualizar data e hora
        function updateDateTime() {
            const now = new Date();
            const dateOptions = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            const timeOptions = { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            };
            
            document.getElementById('currentDate').textContent = now.toLocaleDateString('pt-BR', dateOptions);
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('pt-BR', timeOptions);
            document.getElementById('lastUpdate').textContent = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        }
        
        // Fun√ß√£o para redirecionar para p√°gina de detalhes dos pedidos
        function redirectToPrayerDetails(status) {
            // Redirecionar para p√°gina de detalhes com par√¢metro de status
            window.location.href = `prayer-details.html?status=${status}`;
        }
        
        // Inicializa√ß√£o da p√°gina
        document.addEventListener('DOMContentLoaded', async function() {
            // Verificar acesso admin
            const hasAccess = await checkAdminAccess();
            if (hasAccess) {
                // Carregar informa√ß√µes do usu√°rio e mensagem de boas-vindas
                await loadWelcomeMessage();
                
                // Atualizar data e hora
                updateDateTime();
                setInterval(updateDateTime, 1000); // Atualizar a cada segundo
                
                // Carregar estat√≠sticas do dashboard
                loadStats();
                showSection('dashboard'); // Mostrar dashboard por padr√£o
            }
        });
    </script>
</body>
</html>