<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sistema de Login</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: 
                radial-gradient(circle at 20% 20%, rgba(220, 183, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(209, 26, 5, 0.08) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0a 0%, #1f1f1f 100%);
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
        }

        .dashboard-container {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            max-width: 900px;
            width: 100%;
            text-align: center;
        }

        /* Header do usuário com avatar */
        .user-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            position: relative;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
            justify-content: center;
        }

        .header-icons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .header-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            position: relative;
        }

        .header-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .header-icon.notification-icon[data-notifications]::after {
            content: attr(data-notifications);
            position: absolute;
            top: -5px;
            right: -5px;
            width: 18px;
            height: 18px;
            background: #ff4757;
            border-radius: 50%;
            color: white;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid white;
        }

        .header-icon.notification-icon:not([data-notifications])::after,
        .header-icon.notification-icon[data-notifications="0"]::after {
            display: none;
        }

        .header-icon.support-icon[data-notifications]::after {
            content: attr(data-notifications);
            position: absolute;
            top: -5px;
            right: -5px;
            width: 18px;
            height: 18px;
            background: #ff4757;
            border-radius: 50%;
            color: white;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid white;
        }

        .header-icon.support-icon:not([data-notifications])::after,
        .header-icon.support-icon[data-notifications="0"]::after {
            display: none;
        }

        .header-icon.chat-icon[data-notifications]::after {
            content: attr(data-notifications);
            position: absolute;
            top: -5px;
            right: -5px;
            width: 18px;
            height: 18px;
            background: #2ed573;
            border-radius: 50%;
            color: white;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid white;
        }

        .header-icon.chat-icon:not([data-notifications])::after,
        .header-icon.chat-icon[data-notifications="0"]::after {
            display: none;
        }

        .header-icon.search-icon {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .header-icon.search-icon:hover {
            background: linear-gradient(135deg, #2980b9, #1f5f8b);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .user-avatar-container {
            position: relative;
            width: 60px;
            height: 60px;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-avatar-container:hover {
            transform: scale(1.05);
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid transparent;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-clip: padding-box;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .user-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .user-avatar-fallback {
            display: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .user-avatar-fallback:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .avatar-icon {
            font-size: 24px;
            color: white;
            font-style: normal;
        }

        .welcome-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            font-size: 2.5rem;
            font-weight: 600;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            letter-spacing: -0.5px;
            line-height: 1.2;
            animation: welcomeGlow 3s ease-in-out infinite alternate;
            text-align: center;
        }

        @keyframes welcomeGlow {
            0% {
                filter: brightness(1) drop-shadow(0 0 5px rgba(102, 126, 234, 0.3));
            }
            100% {
                filter: brightness(1.1) drop-shadow(0 0 15px rgba(102, 126, 234, 0.5));
            }
        }

        /* Responsividade para dispositivos móveis */
        @media (max-width: 768px) {
            .user-header {
                flex-direction: column;
                gap: 0.8rem;
                justify-content: center;
            }
            
            .user-info {
                flex-direction: column;
                gap: 0.8rem;
            }
            
            .header-icons:last-child {
                display: none;
            }
            
            .header-icon {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
            
            .user-avatar-container {
                width: 50px;
                height: 50px;
            }
            
            .user-avatar,
            .user-avatar-fallback {
                width: 50px;
                height: 50px;
            }
            
            .avatar-icon {
                font-size: 20px;
            }
            
            .welcome-message {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 480px) {
            .welcome-message {
                font-size: 1.8rem;
            }
            
            .dashboard-container {
                padding: 0.8rem;
                margin: 0;
                width: calc(100vw - 6px);
                border-radius: 8px;
            }
        }

        /* Botão Hambúrguer */
        .hamburger-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .hamburger-btn.active {
            top: 14px;
            left: 220px;
        }

        .hamburger-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .hamburger-btn span {
            width: 25px;
            height: 3px;
            background: white;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .hamburger-btn.active span:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
        }

        .hamburger-btn.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger-btn.active span:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -6px);
        }

        /* Menu Lateral */
        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100vh;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            z-index: 1000;
            transition: left 0.3s ease;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header h3 {
            color: white;
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }



        .sidebar-nav {
            padding: 20px 0;
        }

        .sidebar-nav a {
            display: block;
            padding: 15px 20px;
            color: white;
            text-decoration: none;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .sidebar-nav a:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: white;
            padding-left: 25px;
        }

        /* Overlay */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }



        /* Feed Espiritual */
        .spiritual-feed {
            margin: 2rem 0;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        @media (max-width: 768px) {
            .spiritual-feed {
                margin: 1rem 0;
                padding: 0.8rem;
                border-radius: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .spiritual-feed {
                margin: 0.5rem 0;
                padding: 0.5rem;
                border-radius: 8px;
            }
        }

        .feed-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .feed-header h2 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }

        .feed-tabs {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: #e9ecef;
            color: #6c757d;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .tab-btn:hover:not(.active) {
            background: #dee2e6;
            transform: translateY(-1px);
        }

        .create-post {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        @media (max-width: 768px) {
            .create-post {
                padding: 0.8rem;
                margin-bottom: 1rem;
                border-radius: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .create-post {
                padding: 0.6rem;
                margin-bottom: 0.8rem;
                border-radius: 8px;
            }
        }

        .post-creator {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .creator-avatar {
            position: relative;
            width: 40px;
            height: 40px;
            flex-shrink: 0;
        }

        .creator-avatar img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #e9ecef;
        }

        .creator-avatar-fallback {
            display: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .post-input {
            flex: 1;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 25px;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .post-input:hover {
            background: #e9ecef;
            border-color: #dee2e6;
        }

        .post-input .placeholder {
            color: #6c757d;
            font-size: 0.95rem;
        }

        .post-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .post-type-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #e9ecef;
            background: white;
            color: #495057;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .post-type-btn:hover {
            background: #f8f9fa;
            border-color: #dee2e6;
            transform: translateY(-1px);
        }

        .feed-posts {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .feed-posts::-webkit-scrollbar {
            width: 6px;
        }

        .feed-posts::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .feed-posts::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .feed-posts::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .loading-posts {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .post-item {
            background: white;
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .post-item:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .post-header {
            display: flex;
            align-items: center;
            padding: 1rem;
            gap: 0.75rem;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #e9ecef;
        }

        .post-user-info {
            flex: 1;
        }

        .post-username {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.2rem;
        }

        .post-time {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .post-type-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .post-type-prayer {
            background: #e3f2fd;
            color: #1976d2;
        }

        .post-type-testimony {
            background: #fff3e0;
            color: #f57c00;
        }

        .post-type-devotional {
            background: #e8f5e8;
            color: #388e3c;
        }

        .post-content {
            padding: 0 1rem 1rem;
        }

        .post-text {
            color: #333;
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .post-actions-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            border-top: 1px solid #f1f1f1;
            background: #fafafa;
        }

        .post-action-btn {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .post-action-btn:hover {
            background: #e9ecef;
            color: #495057;
        }

        .post-action-btn.liked {
            color: #dc3545;
        }

        .post-action-btn.delete {
            color: #dc3545;
        }

        .post-action-btn.delete:hover {
            background: #f8d7da;
            color: #721c24;
        }

        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn {
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #ff8c00 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

a         .form-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .form-buttons .btn {
            min-width: 120px;
        }

        .verse-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .verse-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="white" opacity="0.1"/></svg>') repeat;
            pointer-events: none;
        }

        .verse-content {
            position: relative;
            z-index: 1;
        }

        .verse-text {
            font-size: 1.2rem;
            font-style: italic;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .verse-reference {
            font-weight: 600;
            opacity: 0.9;
        }



        /* Estilos para os botões de oração abaixo do versículo */
        .prayer-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .prayer-actions .btn {
            flex: 1;
            max-width: 200px;
            font-size: 0.9rem;
            padding: 12px 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .prayer-actions .btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 768px) {
            .prayer-actions {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .prayer-actions .btn {
                max-width: none;
                width: 100%;
            }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #999;
            font-style: italic;
        }

        .modal-content h2 {
            margin-bottom: 1.5rem;
            color: #333;
            text-align: center;
            font-size: 1.5rem;
        }

        /* Estilos específicos para o modal de perfil */
        .profile-info {
            margin-bottom: 2rem;
        }

        .profile-info .form-group {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .profile-info .form-group label {
            font-weight: 600;
            color: #495057;
            min-width: 140px;
            margin-bottom: 0;
            margin-right: 1rem;
        }

        .profile-info .form-group p {
            margin: 0;
            color: #6c757d;
            font-size: 14px;
            flex: 1;
        }

        .profile-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        .profile-actions .btn {
            min-width: 120px;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #495057;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .character-counter {
            text-align: right;
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        .character-counter.warning {
            color: #ffc107;
        }

        .character-counter.danger {
            color: #dc3545;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid #dc3545;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 300px;
            text-align: center;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid #28a745;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 300px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 1rem;
                margin: 0;
                max-width: 100%;
                width: calc(100vw - 10px);
                border-radius: 10px;
            }

            .welcome-message {
                font-size: 1.5rem;
            }

            .actions {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 10% auto;
                padding: 1.5rem;
            }

            .sidebar {
                width: 280px;
            }

            .hamburger-btn {
                top: 15px;
                left: 15px;
                width: 45px;
                height: 45px;
            }

            /* Feed Responsivo */


            .feed-header h2 {
                font-size: 1.5rem;
            }

            .feed-tabs {
                gap: 0.3rem;
            }

            .tab-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }

            .post-creator {
                flex-direction: column;
                gap: 0.4rem;
                align-items: stretch;
            }

            .post-input {
                text-align: center;
                padding: 0.6rem 0.8rem;
                font-size: 0.9rem;
            }

            .post-actions {
                gap: 0.2rem;
            }

            .post-type-btn {
                padding: 0.3rem 0.6rem;
                font-size: 0.75rem;
            }

            .feed-posts {
                max-height: 500px;
                padding-right: 0.2rem;
            }

            .post-header {
                padding: 0.5rem;
                gap: 0.4rem;
            }

            .post-content {
                padding: 0 0.5rem 0.5rem;
            }
            
            .post-item {
                margin-bottom: 0.8rem;
                border-radius: 8px;
            }

            .post-actions-bar {
                padding: 0.5rem 0.75rem;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .post-action-btn {
                font-size: 0.8rem;
                padding: 0.4rem;
            }
        }

        /* Estilos para comentários */
        .comments-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        .add-comment {
            margin-bottom: 15px;
        }

        .add-comment textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            font-family: inherit;
            font-size: 14px;
        }

        .comment-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
        }

        .comment-actions label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #666;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .comments-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .comment-item {
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .comment-item:last-child {
            border-bottom: none;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .comment-author {
            font-weight: 600;
            font-size: 13px;
            color: #333;
        }

        .comment-time {
            font-size: 11px;
            color: #999;
        }

        .comment-content {
            font-size: 13px;
            line-height: 1.4;
            color: #555;
        }

        /* Melhorias no spinner */
        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsividade para comentários */
        @media (max-width: 768px) {
            .comment-actions {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            .comment-actions label {
                justify-content: center;
            }

            .comments-section {
                margin-top: 10px;
                padding-top: 10px;
            }

            .add-comment textarea {
                font-size: 16px; /* Evita zoom no iOS */
            }
        }


        

    </style>
</head>
<body>
    <!-- Botão Hambúrguer -->
    <button class="hamburger-btn" id="hamburger-btn" onclick="toggleSidebar()">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Menu Lateral -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3>Menu</h3>
        </div>
        <nav class="sidebar-nav">
            <a href="#" onclick="goToProfile(); toggleSidebar();"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg> Meu Perfil</a>
            <a href="#" onclick="goToNotifications(); toggleSidebar();"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg> Notificações</a>
            <a href="#" onclick="openChangePasswordModal(); toggleSidebar();"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg> Trocar Senha</a>
            <a href="#" onclick="openPrayerModal(); toggleSidebar();"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M12 2v20M6 8h12"/></svg> Novo Pedido de Oração</a>
            <a href="#" onclick="viewPrayerRequests(); toggleSidebar();"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg> Ver Meus Pedidos</a>
            <a href="#" id="admin-sidebar-btn" onclick="goToAdmin(); toggleSidebar();" style="display: none;"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg> Painel Admin</a>
            <a href="#" onclick="logout(); toggleSidebar();"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg> Sair</a>
        </nav>
    </div>

    <!-- Overlay para fechar o menu -->
    <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

    <div class="dashboard-container">
        <div id="error-message" style="display: none;"></div>
        
        <!-- Header com Avatar e Nome -->
        <div class="user-header">
            <div class="header-icons">
                <div class="header-icon notification-icon" onclick="goToNotifications()" title="Notificações">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg>
                </div>
                <div class="header-icon support-icon" onclick="goToSupport()" title="Suporte">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 1c-4.97 0-9 4.03-9 9v7c0 1.66 1.34 3 3 3h3v-8H5v-2c0-3.87 3.13-7 7-7s7 3.13 7 7v2h-4v8h3c1.66 0 3-1.34 3-3v-7c0-4.97-4.03-9-9-9z"/></svg>
                </div>
                <div class="header-icon chat-icon" onclick="goToChat()" title="Chat Comunitário">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/></svg>
                </div>
                <div class="header-icon search-icon" onclick="goToSearch()" title="Pesquisar Usuários">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                </div>
            </div>
            
            <div class="user-info">
                <div class="user-avatar-container" onclick="goToProfile()" title="Clique para ver seu perfil">
                    <img id="user-avatar" class="user-avatar" src="" alt="Avatar do usuário" onerror="this.style.display='none'; document.getElementById('user-avatar-fallback').style.display='flex';">
                    <div id="user-avatar-fallback" class="user-avatar-fallback">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    </div>
                </div>
                <h1 class="welcome-message" id="welcome-message">Graça e paz! Que bom ter você aqui novamente.</h1>
            </div>
            
            <div class="header-icons" style="visibility: hidden;">
                <!-- Espaço para manter o layout centralizado -->
                <div class="header-icon"></div>
                <div class="header-icon"></div>
                <div class="header-icon"></div>
            </div>
        </div>
        


        <div class="verse-section">
            <div class="verse-content">
                <div class="verse-text" id="verse-text">Carregando versículo...</div>
                <div class="verse-reference" id="verse-reference"></div>

            </div>
            
            <!-- Botões de Oração abaixo do versículo -->
            <div class="prayer-actions">
                <button class="btn btn-secondary" onclick="openPrayerModal()"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M12 2v20M6 8h12"/></svg> Novo Pedido de Oração</button>
                <button class="btn btn-warning" onclick="viewPrayerRequests()"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg> Ver Meus Pedidos</button>
            </div>
        </div>



        <!-- Feed Espiritual -->
        <div class="spiritual-feed">
            <div class="feed-header">
                <h2><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="margin-right: 8px;"><path d="M12 2v20M6 8h12"/></svg>Feed Espiritual</h2>
                <div class="feed-tabs">
                    <button class="tab-btn active" onclick="switchFeedTab('all', this)">Todos</button>
                    <button class="tab-btn" onclick="switchFeedTab('prayers', this)">Orações</button>
                    <button class="tab-btn" onclick="switchFeedTab('testimonies', this)">Testemunhos</button>
                    <button class="tab-btn" onclick="switchFeedTab('devotionals', this)">Devocionais</button>
                </div>
            </div>
            
            <div class="create-post">
                <div class="post-creator">
                    <div class="post-input" onclick="openCreatePostModal()">
                        <span class="placeholder">Compartilhe uma oração, testemunho ou devocional...</span>
                    </div>
                </div>
                <div class="post-actions">
                    <button class="post-type-btn" onclick="openCreatePostModal('prayer')"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M12 2v20M6 8h12"/></svg> Oração</button>
                    <button class="post-type-btn" onclick="openCreatePostModal('testimony')"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg> Testemunho</button>
                    <button class="post-type-btn" onclick="openCreatePostModal('devotional')"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/></svg> Devocional</button>
                </div>
            </div>
            
            <div class="feed-posts" id="feed-posts">
                <!-- Posts serão carregados aqui dinamicamente -->
                <div class="loading-posts">
                    <div class="spinner"></div>
                    <p>Carregando posts...</p>
                </div>
            </div>
        </div>


    </div>

    <!-- Modal para trocar senha -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeChangePasswordModal()">&times;</span>
            <h2>Trocar Senha</h2>
            <form id="changePasswordForm">
                <div class="form-group">
                    <label for="currentPassword">Senha Atual:</label>
                    <input type="password" id="currentPassword" name="currentPassword" autocomplete="current-password" required>
                </div>
                <div class="form-group">
                    <label for="newPassword">Nova Senha:</label>
                    <input type="password" id="newPassword" name="newPassword" autocomplete="new-password" required>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirmar Nova Senha:</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" autocomplete="new-password" required>
                </div>
                <button type="submit" class="btn btn-primary">Alterar Senha</button>
            </form>
        </div>
    </div>

    <!-- Modal para perfil do usuário -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProfileModal()">&times;</span>
            <h2>👤 Meu Perfil</h2>
            <div class="profile-info">
                <div class="form-group">
                    <label>Nome:</label>
                    <p id="profile-name">Carregando...</p>
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <p id="profile-email">Carregando...</p>
                </div>
                <div class="form-group">
                    <label>Data de Cadastro:</label>
                    <p id="profile-created">Carregando...</p>
                </div>
                <div class="form-group">
                    <label>Último Login:</label>
                    <p id="profile-last-login">Carregando...</p>
                </div>
                <div class="form-group">
                    <label>Total de Pedidos:</label>
                    <p id="profile-prayer-count">Carregando...</p>
                </div>
            </div>
            <div class="profile-actions">
                <button type="button" class="btn btn-secondary" onclick="openChangePasswordModal(); closeProfileModal();"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg> Trocar Senha</button>
                <button type="button" class="btn btn-primary" onclick="closeProfileModal()">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal para criar post no feed -->
    <div id="createPostModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCreatePostModal()">&times;</span>
            <h2 id="createPostTitle"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>Criar Post</h2>
            <form id="createPostForm">
                <div class="form-group">
                    <label for="postType">Tipo de Post:</label>
                    <select id="postType" name="postType" required>
                        <option value="prayer">🙏 Oração</option>
                        <option value="testimony">⭐ Testemunho</option>
                        <option value="devotional">📖 Devocional</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="postContent">Conteúdo:</label>
                    <textarea id="postContent" name="postContent" rows="6" placeholder="Compartilhe sua oração, testemunho ou devocional..." required></textarea>
                </div>

                <button type="submit" class="btn btn-primary">Publicar</button>
            </form>
        </div>
    </div>

    <!-- Modal para novo pedido de oração -->
    <div id="prayerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePrayerModal()">&times;</span>
            <h2><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" style="margin-right: 8px;"><path d="M12 2v20M6 8h12"/></svg>Novo Pedido de Oração</h2>
            <form id="prayerForm">
                <div class="form-group">
                    <label for="prayerCategory">Motivo de Oração:</label>
                    <select id="prayerCategory" name="category" required>
                        <option value="">Selecione o motivo da oração</option>
                        <option value="saude">🏥 Saúde</option>
                        <option value="familia">👨‍👩‍👧‍👦 Família</option>
                        <option value="trabalho">💼 Trabalho</option>
                        <option value="estudos">📚 Estudos</option>
                        <option value="financeiro">💰 Financeiro</option>
                        <option value="relacionamento">💕 Relacionamento</option>
                        <option value="espiritual">🙏 Espiritual</option>
                        <option value="viagem">✈️ Viagem</option>
                        <option value="outros">⭐ Outros</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="prayerDescription">Descrição:</label>
                    <textarea id="prayerDescription" name="description" placeholder="Compartilhe os detalhes do seu pedido de oração..." maxlength="2000" required></textarea>
                    <div class="character-counter">
                        <span id="charCount">0</span>/2000 caracteres
                    </div>
                </div>
                
                <div class="form-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closePrayerModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Enviar Pedido</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Verificar autenticação
        function checkAuth() {
            const token = getAuthToken();
            if (!token) {
                window.location.href = '/login.html';
                return;
            }
            loadUserInfo();
            loadVerse();
            setupMidnightCheck();
        }

        // Função para obter o token de autenticação
        function getAuthToken() {
            // Primeiro tenta localStorage (remember me)
            let sessionData = localStorage.getItem('userSession');
            
            // Se não encontrar, tenta sessionStorage
            if (!sessionData) {
                sessionData = sessionStorage.getItem('userSession');
            }
            
            // Se ainda não encontrar, tenta o token direto (compatibilidade)
            if (!sessionData) {
                return localStorage.getItem('token');
            }
            
            try {
                const session = JSON.parse(sessionData);
                return session.token;
            } catch (error) {
                console.error('Erro ao parsear sessão:', error);
                // Remove sessão inválida
                localStorage.removeItem('userSession');
                sessionStorage.removeItem('userSession');
                return null;
            }
        }

        // Redirecionar para página de perfil
        function goToProfile() {
            window.location.href = '/profile.html';
        }

        // Carregar avatar do usuário
        function loadUserAvatar(user) {
            const avatarImg = document.getElementById('user-avatar');
            const avatarFallback = document.getElementById('user-avatar-fallback');
            
            if (user.profilePicture) {
                // Se o usuário tem foto de perfil, tentar carregá-la
                avatarImg.src = user.profilePicture;
                avatarImg.style.display = 'block';
                avatarFallback.style.display = 'none';
            } else {
                // Se não tem foto, mostrar ícone padrão
                avatarImg.style.display = 'none';
                avatarFallback.style.display = 'flex';
            }
        }

        // Carregar informações do usuário
        async function loadUserInfo() {
            try {
                const token = getAuthToken();
                const response = await fetch('/api/users/profile', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    const user = result.data.user;
                    
                    // Personalizar mensagem de boas-vindas com o primeiro nome
                    const firstName = user.fullName.split(' ')[0];
                    document.getElementById('welcome-message').textContent = `Graça e paz ${firstName}! Que bom ter você aqui novamente.`;
                    
                    // Carregar foto de perfil do usuário
                    loadUserAvatar(user);
                    
                    // Mostrar botão de admin se o usuário for administrador
                    if (user.adminLevel && user.adminLevel > 0) {
                        document.getElementById('admin-sidebar-btn').style.display = 'block';
                    }
                } else {
                    // Se o token for inválido ou expirado, redirecionar para login
                    if (response.status === 401 || response.status === 403) {
                        // Remove todas as formas de autenticação
                        localStorage.removeItem('token');
                        localStorage.removeItem('userSession');
                        sessionStorage.removeItem('userSession');
                        window.location.href = '/login.html';
                        return;
                    }
                    throw new Error('Erro ao carregar informações do usuário');
                }
            } catch (error) {
                console.error('Erro:', error);
                showError('Erro ao carregar informações do usuário');
            }
        }

        // Carregar versículo do dia baseado na data
        async function loadVerse() {
            try {
                // Versículos estáticos para demonstração
                const verses = [
                    {
                        text: "Porque Deus amou o mundo de tal maneira que deu o seu Filho unigênito, para que todo aquele que nele crê não pereça, mas tenha a vida eterna.",
                        reference: "João 3:16"
                    },
                    {
                        text: "Posso todas as coisas naquele que me fortalece.",
                        reference: "Filipenses 4:13"
                    },
                    {
                        text: "O Senhor é o meu pastor; nada me faltará.",
                        reference: "Salmos 23:1"
                    },
                    {
                        text: "Entrega o teu caminho ao Senhor; confia nele, e ele tudo fará.",
                        reference: "Salmos 37:5"
                    },
                    {
                        text: "E sabemos que todas as coisas contribuem juntamente para o bem daqueles que amam a Deus.",
                        reference: "Romanos 8:28"
                    },
                    {
                        text: "Não temas, porque eu sou contigo; não te assombres, porque eu sou teu Deus.",
                        reference: "Isaías 41:10"
                    },
                    {
                        text: "Buscai primeiro o reino de Deus, e a sua justiça, e todas estas coisas vos serão acrescentadas.",
                        reference: "Mateus 6:33"
                    }
                ];
                
                // Usar a data atual para selecionar o versículo do dia
                const today = new Date();
                const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);
                const verseIndex = dayOfYear % verses.length;
                
                const dailyVerse = verses[verseIndex];
                document.getElementById('verse-text').textContent = dailyVerse.text;
                document.getElementById('verse-reference').textContent = dailyVerse.reference;
                
                // Armazenar a data do último carregamento
                localStorage.setItem('lastVerseDate', today.toDateString());
            } catch (error) {
                console.error('Erro ao carregar versículo:', error);
                document.getElementById('verse-text').textContent = 'Erro ao carregar versículo';
            }
        }
        
        // Verificar se o dia mudou e atualizar o versículo
        function checkForNewDay() {
            const today = new Date();
            const lastVerseDate = localStorage.getItem('lastVerseDate');
            
            if (!lastVerseDate || lastVerseDate !== today.toDateString()) {
                loadVerse();
            }
        }
        
        // Configurar verificação automática à meia-noite
        function setupMidnightCheck() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            const msUntilMidnight = tomorrow.getTime() - now.getTime();
            
            // Configurar timeout para a próxima meia-noite
            setTimeout(() => {
                loadVerse(); // Carregar novo versículo à meia-noite
                
                // Configurar intervalo para verificar a cada 24 horas
                setInterval(() => {
                    loadVerse();
                }, 24 * 60 * 60 * 1000); // 24 horas em milissegundos
            }, msUntilMidnight);
            
            // Verificar a cada minuto se o dia mudou (backup)
            setInterval(checkForNewDay, 60000);
        }

        // Modais
        function openChangePasswordModal() {
            document.getElementById('changePasswordModal').style.display = 'block';
        }

        function closeChangePasswordModal() {
            document.getElementById('changePasswordModal').style.display = 'none';
            document.getElementById('changePasswordForm').reset();
        }

        function openPrayerModal() {
            document.getElementById('prayerModal').style.display = 'block';
        }

        function closePrayerModal() {
            document.getElementById('prayerModal').style.display = 'none';
            document.getElementById('prayerForm').reset();
        }

        // Fechar modal clicando fora
        window.onclick = function(event) {
            const changePasswordModal = document.getElementById('changePasswordModal');
            const prayerModal = document.getElementById('prayerModal');
            const profileModal = document.getElementById('profileModal');
            
            if (event.target === changePasswordModal) {
                closeChangePasswordModal();
            }
            if (event.target === prayerModal) {
                closePrayerModal();
            }
            if (event.target === profileModal) {
                closeProfileModal();
            }
        }

        // Trocar senha
        document.getElementById('changePasswordForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                showError('As senhas não coincidem');
                return;
            }
            
            try {
                const token = getAuthToken();
                const response = await fetch('/api/users/change-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        currentPassword,
                        newPassword
                    })
                });

        // Contador de caracteres em tempo real
        document.getElementById('prayerDescription').addEventListener('input', function() {
            const textarea = this;
            const charCount = document.getElementById('charCount');
            const counter = document.querySelector('.character-counter');
            const currentLength = textarea.value.length;
            const maxLength = 2000;
            
            charCount.textContent = currentLength;
            
            // Remove classes anteriores
            counter.classList.remove('warning', 'danger');
            
            // Adiciona classes baseadas na porcentagem
            if (currentLength >= maxLength * 0.9) {
                counter.classList.add('danger');
            } else if (currentLength >= maxLength * 0.75) {
                counter.classList.add('warning');
            }
        });

        // Atualiza contador quando o modal é aberto
        function openPrayerModal() {
            document.getElementById('prayerModal').style.display = 'block';
            document.getElementById('charCount').textContent = '0';
            document.querySelector('.character-counter').classList.remove('warning', 'danger');
        }
                
                if (response.ok) {
                    showSuccess('Senha alterada com sucesso!');
                    closeChangePasswordModal();
                } else {
                    const error = await response.json();
                    showError(error.message || 'Erro ao alterar senha');
                }
            } catch (error) {
                console.error('Erro:', error);
                showError('Erro ao alterar senha');
            }
        });

        // Contador de caracteres em tempo real
        document.getElementById('prayerDescription').addEventListener('input', function() {
            const textarea = this;
            const charCount = document.getElementById('charCount');
            const counter = document.querySelector('.character-counter');
            const currentLength = textarea.value.length;
            const maxLength = 2000;
            
            charCount.textContent = currentLength;
            
            // Remove classes anteriores
            counter.classList.remove('warning', 'danger');
            
            // Adiciona classes baseadas na porcentagem
            if (currentLength >= maxLength * 0.9) {
                counter.classList.add('danger');
            } else if (currentLength >= maxLength * 0.75) {
                counter.classList.add('warning');
            }
        });

        // Atualiza contador quando o modal é aberto
        function openPrayerModal() {
            document.getElementById('prayerModal').style.display = 'block';
            document.getElementById('charCount').textContent = '0';
            document.querySelector('.character-counter').classList.remove('warning', 'danger');
        }

        // Enviar pedido de oração
        document.getElementById('prayerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const prayerData = {
                description: formData.get('description'),
                category: formData.get('category')
            };
            
            try {
                const token = getAuthToken();
                const response = await fetch('/api/pedidos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(prayerData)
                });

        // Contador de caracteres em tempo real
        document.getElementById('prayerDescription').addEventListener('input', function() {
            const textarea = this;
            const charCount = document.getElementById('charCount');
            const counter = document.querySelector('.character-counter');
            const currentLength = textarea.value.length;
            const maxLength = 2000;
            
            charCount.textContent = currentLength;
            
            // Remove classes anteriores
            counter.classList.remove('warning', 'danger');
            
            // Adiciona classes baseadas na porcentagem
            if (currentLength >= maxLength * 0.9) {
                counter.classList.add('danger');
            } else if (currentLength >= maxLength * 0.75) {
                counter.classList.add('warning');
            }
        });

        // Atualiza contador quando o modal é aberto
        function openPrayerModal() {
            document.getElementById('prayerModal').style.display = 'block';
            document.getElementById('charCount').textContent = '0';
            document.querySelector('.character-counter').classList.remove('warning', 'danger');
        }
                
                if (response.ok) {
                    showSuccess('Pedido de oração enviado com sucesso');
                    closePrayerModal();
                    document.getElementById('prayerForm').reset();
                } else {
                    const error = await response.json();
                    showError(error.message || 'Erro ao enviar pedido');
                }
            } catch (error) {
                console.error('Erro:', error);
                showError('Erro ao enviar pedido de oração');
            }
        });

        // Contador de caracteres em tempo real
        document.getElementById('prayerDescription').addEventListener('input', function() {
            const textarea = this;
            const charCount = document.getElementById('charCount');
            const counter = document.querySelector('.character-counter');
            const currentLength = textarea.value.length;
            const maxLength = 2000;
            
            charCount.textContent = currentLength;
            
            // Remove classes anteriores
            counter.classList.remove('warning', 'danger');
            
            // Adiciona classes baseadas na porcentagem
            if (currentLength >= maxLength * 0.9) {
                counter.classList.add('danger');
            } else if (currentLength >= maxLength * 0.75) {
                counter.classList.add('warning');
            }
        });

        // Atualiza contador quando o modal é aberto
        function openPrayerModal() {
            document.getElementById('prayerModal').style.display = 'block';
            document.getElementById('charCount').textContent = '0';
            document.querySelector('.character-counter').classList.remove('warning', 'danger');
        }

        // Função para ver pedidos de oração
        function viewPrayerRequests() {
            window.location.href = 'meus-pedidos.html';
        }

        // Função para ir ao perfil
        function goToProfile() {
            window.location.href = '/profile.html';
        }

        // Funções para o modal de perfil
        function openProfileModal() {
            document.getElementById('profileModal').style.display = 'block';
            loadProfileInfo();
        }

        function closeProfileModal() {
            document.getElementById('profileModal').style.display = 'none';
        }

        // Função para carregar informações do perfil
        async function loadProfileInfo() {
            try {
                const token = getAuthToken();
                if (!token) {
                    window.location.href = '/login.html';
                    return;
                }

                const response = await fetch('/api/users/profile', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const profile = await response.json();
                    
                    document.getElementById('profile-name').textContent = profile.name || 'Não informado';
                    document.getElementById('profile-email').textContent = profile.email || 'Não informado';
                    
                    // Formatar data de cadastro
                    const createdDate = new Date(profile.createdAt);
                    document.getElementById('profile-created').textContent = createdDate.toLocaleDateString('pt-BR');
                    
                    // Formatar último login
                    const lastLogin = profile.lastLogin ? new Date(profile.lastLogin).toLocaleDateString('pt-BR') : 'Nunca';
                    document.getElementById('profile-last-login').textContent = lastLogin;
                    
                    // Total de pedidos
                    document.getElementById('profile-prayer-count').textContent = profile.prayerCount || '0';
                } else {
                    showError('Erro ao carregar informações do perfil');
                }
            } catch (error) {
                console.error('Erro:', error);
                showError('Erro ao carregar informações do perfil');
            }
        }

        // Função para controlar o menu lateral
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const hamburgerBtn = document.getElementById('hamburger-btn');
            
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
            hamburgerBtn.classList.toggle('active');
        }

        // Função de logout
        function logout() {
            // Remove todas as formas de autenticação
            localStorage.removeItem('token');
            localStorage.removeItem('userSession');
            sessionStorage.removeItem('userSession');
            
            // Redireciona para a página de login
            window.location.href = '/login.html';
        }

        // Função para ir ao painel admin
        function goToAdmin() {
            window.location.href = '/admin.html';
        }

        // Função para ir às notificações
        function goToNotifications() {
            window.location.href = '/notifications.html';
        }

        // Funções de utilidade
        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function showSuccess(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.className = 'success-message';
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 3000);
        }

        // Variáveis globais do feed
        let currentFeedTab = 'all';
        let feedPosts = [];
        let currentPage = 1;
        let isLoading = false;

        // Funções do Feed Espiritual
        function switchFeedTab(tab, element) {
            // Prevenir comportamento padrão se for um evento
            if (window.event) {
                window.event.preventDefault();
            }
            
            currentFeedTab = tab;
            currentPage = 1;
            
            // Atualizar botões das abas
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ativar o botão clicado
            if (element) {
                element.classList.add('active');
            }
            
            // Carregar posts da nova aba
            loadFeedPosts(true);
        }

        function openCreatePostModal(type = null) {
            const modal = document.getElementById('createPostModal');
            const postTypeSelect = document.getElementById('postType');
            const title = document.getElementById('createPostTitle');
            
            if (type) {
                postTypeSelect.value = type;
                const typeNames = {
                    'prayer': '🙏 Criar Oração',
                    'testimony': '✨ Criar Testemunho',
                    'devotional': '📖 Criar Devocional'
                };
                title.textContent = typeNames[type];
            } else {
                title.textContent = '✨ Criar Post';
            }
            
            modal.style.display = 'block';
        }

        function closeCreatePostModal() {
            const modal = document.getElementById('createPostModal');
            modal.style.display = 'none';
            document.getElementById('createPostForm').reset();
        }

        async function loadFeedPosts(reset = false) {
            if (isLoading) return;
            
            isLoading = true;
            const feedContainer = document.getElementById('feed-posts');
            
            if (reset) {
                feedPosts = [];
                currentPage = 1;
                feedContainer.innerHTML = `
                    <div class="loading-posts">
                        <div class="spinner"></div>
                        <p>Carregando posts...</p>
                    </div>
                `;
            }
            
            try {
                const token = getAuthToken();
                const typeFilter = currentFeedTab === 'all' ? '' : {
                    'prayers': 'oracao',
                    'testimonies': 'testemunho', 
                    'devotionals': 'devocional'
                }[currentFeedTab];
                
                const url = new URL('/api/feed/posts', window.location.origin);
                url.searchParams.append('page', currentPage);
                url.searchParams.append('limit', '10');
                if (typeFilter) {
                    url.searchParams.append('type', typeFilter);
                }
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Obter ID do usuário atual
                    const currentUserId = await getCurrentUserId();
                    
                    // Adicionar propriedade canDelete aos posts
                    const postsWithDeletePermission = data.posts.map(post => ({
                        ...post,
                        canDelete: post.user_id === currentUserId
                    }));
                    
                    if (reset) {
                        feedPosts = postsWithDeletePermission;
                    } else {
                        feedPosts = [...feedPosts, ...postsWithDeletePermission];
                    }
                    
                    await checkLikeStatuses();
                    displayFilteredPosts();
                    
                    currentPage++;
                } else {
                    throw new Error('Erro ao carregar posts');
                }
            } catch (error) {
                console.error('Erro ao carregar posts:', error);
                feedContainer.innerHTML = `
                    <div class="loading-posts">
                        <p>Erro ao carregar posts. Tente novamente.</p>
                        <button onclick="loadFeedPosts(true)" class="btn btn-primary">Tentar Novamente</button>
                    </div>
                `;
            } finally {
                isLoading = false;
            }
        }

        async function checkLikeStatuses() {
            const token = localStorage.getItem('token');
            
            for (let post of feedPosts) {
                try {
                    const response = await fetch(`/api/feed/posts/${post.id}/like-status`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        post.isLiked = data.isLiked;
                    }
                } catch (error) {
                    console.error('Erro ao verificar status de curtida:', error);
                }
            }
        }

        function displayFilteredPosts() {
            const feedContainer = document.getElementById('feed-posts');
            
            if (feedPosts.length === 0) {
                feedContainer.innerHTML = `
                    <div class="loading-posts">
                        <p>Nenhum post encontrado nesta categoria.</p>
                    </div>
                `;
                return;
            }
            
            feedContainer.innerHTML = feedPosts.map(post => createPostHTML(post)).join('');
        }

        function createPostHTML(post) {
            // Garantir que created_at existe, senão usar timestamp atual
            const timestamp = post.created_at || post.timestamp || new Date().toISOString();
            const timeAgo = getTimeAgo(timestamp);
            
            const typeLabels = {
                'prayer': '🙏 Oração',
                'testimony': '✨ Testemunho',
                'devotional': '📖 Devocional'
            };
            
            // Garantir que o tipo do post seja válido
            const postType = post.type || 'prayer';
            const typeLabel = typeLabels[postType] || '🙏 Oração';
            
            // Garantir que author_name existe
            const authorName = post.is_anonymous ? 'Usuário Anônimo' : (post.author_name || post.author || 'Usuário');
            
            // Garantir que contadores existem
            const likesCount = post.likes_count || post.likes || 0;
            const commentsCount = post.comments_count || post.comments || 0;
            
            return `
                <div class="post-item" data-post-id="${post.id}">
                    <div class="post-header">
                        <img class="post-avatar" src="${post.author_picture || post.avatar || ''}" alt="Avatar" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="creator-avatar-fallback" style="display: none;"></div>
                        <div class="post-user-info">
                            <div class="post-username">${authorName}</div>
                            <div class="post-time">${timeAgo}</div>
                        </div>
                        <span class="post-type-badge post-type-${postType}">${typeLabel}</span>
                    </div>
                    <div class="post-content">
                        <div class="post-text">${(post.content || '').replace(/\n/g, '<br>')}</div>
                    </div>
                    <div class="post-actions-bar">
                        <button class="post-action-btn ${post.isLiked ? 'liked' : ''}" onclick="toggleLike(${post.id})">
                            <span>${post.isLiked ? '❤️' : '🤍'}</span>
                            <span>${likesCount}</span>
                        </button>
                        <button class="post-action-btn" onclick="showComments(${post.id})">
                            <span>💬</span>
                            <span>${commentsCount}</span>
                        </button>
                        <button class="post-action-btn" onclick="sharePost(${post.id})">
                            <span>🔗</span>
                            <span>Compartilhar</span>
                        </button>
                        ${post.canDelete ? `<button class="post-action-btn delete-btn" onclick="deletePost(${post.id})">
                            <span>🗑️</span>
                            <span>Deletar</span>
                        </button>` : ''}
                    </div>
                    <div class="post-comments" id="comments-${post.id}" style="display: none;">
                        <!-- Comentários serão carregados aqui -->
                    </div>
                </div>
            `;
        }

        function getTimeAgo(timestamp) {
            if (!timestamp) {
                return 'agora';
            }
            
            const now = new Date();
            const postDate = new Date(timestamp);
            
            // Verificar se a data é válida
            if (isNaN(postDate.getTime())) {
                return 'agora';
            }
            
            const diff = now - postDate;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) {
                return 'agora';
            } else if (minutes < 60) {
                return `${minutes}m`;
            } else if (hours < 24) {
                return `${hours}h`;
            } else {
                return `${days}d`;
            }
        }

        async function toggleLike(postId) {
            try {
                const token = getAuthToken();
                const response = await fetch(`/api/feed/posts/${postId}/like`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const post = feedPosts.find(p => p.id === postId);
                    if (post) {
                        post.isLiked = data.isLiked;
                        post.likes_count = data.likesCount;
                        post.likes = data.likesCount; // Para compatibilidade
                        displayFilteredPosts();
                    }
                } else {
                    showError('Erro ao curtir post');
                }
            } catch (error) {
                console.error('Erro ao curtir post:', error);
                showError('Erro ao curtir post');
            }
        }

        async function showComments(postId) {
            const commentsDiv = document.getElementById(`comments-${postId}`);
            
            if (commentsDiv.style.display === 'none') {
                // Carregar e mostrar comentários
                await loadComments(postId);
                commentsDiv.style.display = 'block';
            } else {
                // Esconder comentários
                commentsDiv.style.display = 'none';
            }
        }

        async function loadComments(postId) {
            try {
                const token = getAuthToken();
                const response = await fetch(`/api/feed/posts/${postId}/comments`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const comments = await response.json();
                    const commentsDiv = document.getElementById(`comments-${postId}`);
                    
                    let commentsHTML = `
                        <div class="comments-section">
                            <div class="add-comment">
                                <textarea id="comment-input-${postId}" placeholder="Escreva um comentário..." rows="2"></textarea>
                                <div class="comment-actions">
                                    <label>
                                        <input type="checkbox" id="comment-anonymous-${postId}"> Comentar anonimamente
                                    </label>
                                    <button onclick="addComment(${postId})" class="btn btn-primary btn-sm">Comentar</button>
                                </div>
                            </div>
                            <div class="comments-list">
                    `;
                    
                    comments.forEach(comment => {
                        const commentTime = getTimeAgo(comment.created_at);
                        commentsHTML += `
                            <div class="comment-item">
                                <div class="comment-header">
                                    <span class="comment-author">${comment.is_anonymous ? 'Usuário Anônimo' : comment.author_name}</span>
                                    <span class="comment-time">${commentTime}</span>
                                </div>
                                <div class="comment-content">${comment.content.replace(/\n/g, '<br>')}</div>
                            </div>
                        `;
                    });
                    
                    commentsHTML += `
                            </div>
                        </div>
                    `;
                    
                    commentsDiv.innerHTML = commentsHTML;
                } else {
                    showError('Erro ao carregar comentários');
                }
            } catch (error) {
                console.error('Erro ao carregar comentários:', error);
                showError('Erro ao carregar comentários');
            }
        }

        async function addComment(postId) {
            const commentInput = document.getElementById(`comment-input-${postId}`);
            const anonymousCheckbox = document.getElementById(`comment-anonymous-${postId}`);
            const content = commentInput.value.trim();
            
            if (!content) {
                showError('Por favor, escreva um comentário');
                return;
            }
            
            try {
                const token = getAuthToken();
                const response = await fetch(`/api/feed/posts/${postId}/comments`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        content: content,
                        is_anonymous: anonymousCheckbox.checked
                    })
                });
                
                if (response.ok) {
                    commentInput.value = '';
                    anonymousCheckbox.checked = false;
                    
                    // Atualizar contador de comentários
                    const post = feedPosts.find(p => p.id === postId);
                    if (post) {
                        post.comments_count = (post.comments_count || 0) + 1;
                        post.comments = post.comments_count; // Para compatibilidade
                    }
                    
                    // Recarregar comentários
                    await loadComments(postId);
                    displayFilteredPosts();
                    
                    showSuccess('Comentário adicionado com sucesso!');
                } else {
                    showError('Erro ao adicionar comentário');
                }
            } catch (error) {
                console.error('Erro ao adicionar comentário:', error);
                showError('Erro ao adicionar comentário');
            }
        }

        function sharePost(postId) {
            const post = feedPosts.find(p => p.id === postId);
            if (post) {
                const shareText = `Confira este ${post.type === 'prayer' ? 'pedido de oração' : post.type === 'testimony' ? 'testemunho' : 'devocional'} no nosso feed espiritual!`;
                const shareUrl = `${window.location.origin}/dashboard.html#post-${postId}`;
                
                if (navigator.share) {
                    navigator.share({
                        title: shareText,
                        url: shareUrl
                    }).catch(console.error);
                } else {
                    // Fallback para copiar para área de transferência
                    navigator.clipboard.writeText(shareUrl).then(() => {
                        showSuccess('Link do post copiado para a área de transferência!');
                    }).catch(() => {
                        showError('Erro ao copiar link');
                    });
                }
            }
        }

        // Função para obter o ID do usuário atual
        async function getCurrentUserId() {
            try {
                const token = getAuthToken();
                const response = await fetch('/api/users/profile', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    return result.data.user.id;
                }
            } catch (error) {
                console.error('Erro ao obter ID do usuário:', error);
            }
            return null;
        }

        // Função para deletar um post
        async function deletePost(postId) {
            if (!confirm('Tem certeza que deseja deletar este post? Esta ação não pode ser desfeita.')) {
                return;
            }
            
            try {
                const token = getAuthToken();
                const response = await fetch(`/api/feed/posts/${postId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    // Remove o post da lista local
                    feedPosts = feedPosts.filter(post => post.id !== postId);
                    displayFilteredPosts();
                    showSuccess('Post deletado com sucesso!');
                } else {
                    const error = await response.json();
                    showError(error.message || 'Erro ao deletar post');
                }
            } catch (error) {
                console.error('Erro ao deletar post:', error);
                showError('Erro ao deletar post');
            }
        }

        // Event listener para o formulário de criar post
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            
            // Carregar posts do feed
            loadFeedPosts(true);
            
            // Event listener para criar post
            document.getElementById('createPostForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const postData = {
                    type: formData.get('postType'),
                    content: formData.get('postContent'),
                    is_anonymous: false
                };
                
                try {
                    const token = getAuthToken();
                    const response = await fetch('/api/feed/posts', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(postData)
                    });
                    
                    if (response.ok) {
                        const newPost = await response.json();
                        
                        // Verificar se a resposta contém os dados do post
                        if (newPost && newPost.id) {
                            // Obter ID do usuário atual para definir canDelete
                            const currentUserId = await getCurrentUserId();
                            
                            // Adicionar o novo post ao início da lista com todos os campos necessários
                            feedPosts.unshift({
                                ...newPost,
                                isLiked: false,
                                likes_count: newPost.likes_count || 0,
                                comments_count: newPost.comments_count || 0,
                                likes: newPost.likes || 0,
                                comments: newPost.comments || 0,
                                canDelete: newPost.user_id === currentUserId,
                                created_at: newPost.created_at || new Date().toISOString()
                            });
                            
                            displayFilteredPosts();
                            closeCreatePostModal();
                            showSuccess('Post publicado com sucesso!');
                        } else {
                            showError('Erro: dados do post não recebidos');
                        }
                    } else {
                        const error = await response.json();
                        showError(error.message || 'Erro ao criar post');
                    }
                } catch (error) {
                    console.error('Erro ao criar post:', error);
                    showError('Erro ao criar post');
                }
            });
            
            // Atualizar avatar do criador de posts
            const userAvatar = document.getElementById('user-avatar');
            // Avatar removido da área de criação de posts
        });

        // Função para ir para a página de suporte
        function goToSupport() {
            window.location.href = 'messages.html';
        }

        // Função para ir para o chat comunitário
        function goToChat() {
            window.location.href = 'chat.html';
        }

        // Função para ir para a página de pesquisa de usuários
        function goToSearch() {
            window.location.href = 'search-users.html';
        }

        // Função para atualizar badge de notificações do chat
        function updateChatNotifications(count) {
            const chatIcon = document.querySelector('.header-icon.chat-icon');
            if (chatIcon) {
                if (count > 0) {
                    chatIcon.setAttribute('data-notifications', count.toString());
                } else {
                    chatIcon.removeAttribute('data-notifications');
                }
            }
        }

        // Função para atualizar badge de notificações gerais
        function updateGeneralNotifications(count) {
            const notificationIcon = document.querySelector('.header-icon.notification-icon');
            if (notificationIcon) {
                if (count > 0) {
                    notificationIcon.setAttribute('data-notifications', count.toString());
                } else {
                    notificationIcon.removeAttribute('data-notifications');
                }
            }
        }

        // Função para atualizar badge de notificações de suporte
        function updateSupportNotifications(count) {
            const supportIcon = document.querySelector('.header-icon.support-icon');
            if (supportIcon) {
                if (count > 0) {
                    supportIcon.setAttribute('data-notifications', count.toString());
                } else {
                    supportIcon.removeAttribute('data-notifications');
                }
            }
        }

        // Função para carregar notificações do chat
        async function loadChatNotifications() {
            try {
                // Por enquanto, definindo como 0 até implementar a lógica do servidor
                // No futuro, fazer uma requisição para o servidor para obter o número real
                const notificationCount = 0;
                updateChatNotifications(notificationCount);
            } catch (error) {
                console.error('Erro ao carregar notificações do chat:', error);
                updateChatNotifications(0);
            }
        }

        // Função para carregar notificações gerais
        async function loadGeneralNotifications() {
            try {
                // Por enquanto, definindo como 0 até implementar a lógica do servidor
                // No futuro, fazer uma requisição para o servidor para obter o número real
                const notificationCount = 0;
                updateGeneralNotifications(notificationCount);
            } catch (error) {
                console.error('Erro ao carregar notificações gerais:', error);
                updateGeneralNotifications(0);
            }
        }

        // Função para carregar notificações de suporte
        async function loadSupportNotifications() {
            try {
                // Por enquanto, definindo como 0 até implementar a lógica do servidor
                // No futuro, fazer uma requisição para o servidor para obter o número real
                const notificationCount = 0;
                updateSupportNotifications(notificationCount);
            } catch (error) {
                console.error('Erro ao carregar notificações de suporte:', error);
                updateSupportNotifications(0);
            }
        }

        // Carregar todas as notificações quando a página carregar
        document.addEventListener('DOMContentLoaded', function() {
            loadChatNotifications();
            loadGeneralNotifications();
            loadSupportNotifications();
        });

        // Variáveis globais para anúncios




        // Inicializar quando a página carregar
        // document.addEventListener('DOMContentLoaded', checkAuth);
    </script>
</body>
</html>